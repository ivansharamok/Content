<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Works on my machine</title>
    <description>Notes, thoughts, experiments</description>
    <link>http://localhost:4000/</link>
    <atom:link href="http://localhost:4000/feed.xml" rel="self" type="application/rss+xml"/>
    <pubDate>Mon, 11 Dec 2017 00:05:59 -0800</pubDate>
    <lastBuildDate>Mon, 11 Dec 2017 00:05:59 -0800</lastBuildDate>
    <generator>Jekyll v3.6.2</generator>
    
      <item>
        <title>Sitecore Publishing Service in Docker Windows Container</title>
        <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#prepare-docker-image&quot; id=&quot;markdown-toc-prepare-docker-image&quot;&gt;Prepare Docker image&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#two-modes-to-run-publishing-service&quot; id=&quot;markdown-toc-two-modes-to-run-publishing-service&quot;&gt;Two modes to run Publishing Service&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#run-it-as-console-app&quot; id=&quot;markdown-toc-run-it-as-console-app&quot;&gt;Run it as console app&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#run-it-as-iis-web-site&quot; id=&quot;markdown-toc-run-it-as-iis-web-site&quot;&gt;Run it as IIS web site&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#service-logging&quot; id=&quot;markdown-toc-service-logging&quot;&gt;Service logging&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#utility-scripts&quot; id=&quot;markdown-toc-utility-scripts&quot;&gt;Utility scripts&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#examples-to-create-containers-passing-differnt-parameters&quot; id=&quot;markdown-toc-examples-to-create-containers-passing-differnt-parameters&quot;&gt;Examples to create containers passing differnt parameters&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#run-container-using-default-configuration&quot; id=&quot;markdown-toc-run-container-using-default-configuration&quot;&gt;Run container using default configuration&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#run-container-and-configure-connection-strings&quot; id=&quot;markdown-toc-run-container-and-configure-connection-strings&quot;&gt;Run container and configure connection strings&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#run-service-as-iis-web-site&quot; id=&quot;markdown-toc-run-service-as-iis-web-site&quot;&gt;Run service as IIS web site&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#reconfigure-running-service&quot; id=&quot;markdown-toc-reconfigure-running-service&quot;&gt;Reconfigure running service&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#gotchas&quot; id=&quot;markdown-toc-gotchas&quot;&gt;Gotchas&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#copying-files-between-host-and-container&quot; id=&quot;markdown-toc-copying-files-between-host-and-container&quot;&gt;Copying files between host and container&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#localhost-mapping&quot; id=&quot;markdown-toc-localhost-mapping&quot;&gt;localhost mapping&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#installing-windows-hosting-sometimes-fails&quot; id=&quot;markdown-toc-installing-windows-hosting-sometimes-fails&quot;&gt;Installing windows hosting sometimes fails&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The article describes how I managed to put &lt;a href=&quot;https://dev.sitecore.net/Downloads/Sitecore_Publishing_Service.aspx&quot;&gt;Sitecore Publishing Service&lt;/a&gt; into a Docker Windows container. Docker image &lt;a href=&quot;https://hub.docker.com/r/microsoft/windowsservercore/&quot;&gt;microsoft/windowsservercore&lt;/a&gt; was used to create an image with the Publishing Service.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;To run Sitecore Publishing Service in a Docker container make sure you switch Docker host to use Windows Containers.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;Image &lt;a href=&quot;https://hub.docker.com/r/microsoft/nanoserver/&quot;&gt;microsoft/nanoserver&lt;/a&gt; cannot be used as Publishing Service up to version 3.0 has a dependency on &lt;code class=&quot;highlighter-rouge&quot;&gt;Microsoft.Practices.EnterpriseLibrary.TransientFaultHandling.Data.dll&lt;/code&gt; library which depends on full .NET Framework.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;TL;TR
Skip all the blabber and go straight to resources:&lt;/p&gt;
  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;/resources/media/2017-11-24-publishing-service-in-docker-container/Dockerfile&quot;&gt;Dockerfile&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;/resources/media/2017-11-24-publishing-service-in-docker-container/scripts&quot;&gt;scripts&lt;/a&gt;&lt;/li&gt;
  &lt;/ul&gt;
&lt;/blockquote&gt;

&lt;p&gt;The scripts provided in this article assume the following folder configuration structure for docker build directory:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;/build_dir
    &lt;ul&gt;
      &lt;li&gt;Dockerfile&lt;/li&gt;
      &lt;li&gt;/res - contains &lt;a href=&quot;https://dev.sitecore.net/Downloads/Sitecore_Publishing_Service.aspx&quot;&gt;Publishing Service&lt;/a&gt; zip and &lt;a href=&quot;https://aka.ms/dotnetcore_windowshosting_1_1_0&quot;&gt;dotnetcore windows hosting&lt;/a&gt; exe.
        &lt;ul&gt;
          &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Sitecore Publishing Service 2.1.0 rev. 171009.zip&lt;/code&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;/scripts - contains necessary &lt;a href=&quot;/resources/media/2017-11-24-publishing-service-in-docker-container/scripts&quot;&gt;powershell scripts&lt;/a&gt; to build the container image and work with Publishing Service.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
  &lt;p&gt;You may put &lt;a href=&quot;https://aka.ms/dotnetcore_windowshosting_1_1_0&quot;&gt;dotnetcore_windowshosting_1_1_0.exe&lt;/a&gt; into &lt;code class=&quot;highlighter-rouge&quot;&gt;/res&lt;/code&gt; directory to speed up image building process a bit.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;prepare-docker-image&quot;&gt;Prepare Docker image&lt;/h2&gt;
&lt;p&gt;Before building an image make sure you provide valid database connection strings in &lt;a href=&quot;/resources/media/2017-11-24-publishing-service-in-docker-container/Dockerfile&quot;&gt;Dockerfile&lt;/a&gt;. Dowonload one of Sitecore Publishing Service versions and move service zip into the &lt;code class=&quot;highlighter-rouge&quot;&gt;/res&lt;/code&gt; dirctory. Downloaded &lt;a href=&quot;/resources/media/2017-11-24-publishing-service-in-docker-container/scripts&quot;&gt;scripts&lt;/a&gt; and move them into the &lt;code class=&quot;highlighter-rouge&quot;&gt;/scripts&lt;/code&gt; directory. Using the &lt;a href=&quot;/resources/media/2017-11-24-publishing-service-in-docker-container/Dockerfile&quot;&gt;Dockerfile&lt;/a&gt; and &lt;a href=&quot;/resources/media/2017-11-24-publishing-service-in-docker-container/scripts&quot;&gt;scripts&lt;/a&gt; run &lt;code class=&quot;highlighter-rouge&quot;&gt;docker build .&lt;/code&gt; command to create an image with installed Publishing Service in it.&lt;/p&gt;

&lt;h3 id=&quot;two-modes-to-run-publishing-service&quot;&gt;Two modes to run Publishing Service&lt;/h3&gt;
&lt;p&gt;The service can be started as a console app or as an IIS web site.&lt;/p&gt;

&lt;h4 id=&quot;run-it-as-console-app&quot;&gt;Run it as console app&lt;/h4&gt;
&lt;p&gt;When running the service as console app over Kestrel web server, there is no need to install &lt;code class=&quot;highlighter-rouge&quot;&gt;Web-Server&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;Web-Asp-Net45&lt;/code&gt; features. The script &lt;a href=&quot;/resources/media/2017-11-24-publishing-service-in-docker-container/scripts/start-service.ps1&quot;&gt;start-service.ps1&lt;/a&gt; starts the service with 5001 port by default. Inspect the script to understand what parameters it accepts.&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;Provided Dockerfile uses &lt;code class=&quot;highlighter-rouge&quot;&gt;start-service.ps1&lt;/code&gt; script as default command to run the container instance.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&quot;run-it-as-iis-web-site&quot;&gt;Run it as IIS web site&lt;/h4&gt;
&lt;p&gt;When running the service as IIS web site, the Windows features &lt;code class=&quot;highlighter-rouge&quot;&gt;Web-Server&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;Web-Asp-Net45&lt;/code&gt; must be installed and the service must be configured in IIS. Use script &lt;a href=&quot;/resources/media/2017-11-24-publishing-service-in-docker-container/scripts/install-iiswebsite.ps1&quot;&gt;install-iiswebsite.ps1&lt;/a&gt; to install the features and configure the service in IIS. Inspect the script to understand what parameters it accepts.&lt;br /&gt;
In this mode you must insure that web site worker process starts as you run the container. Otherwise, the container will shut down promptly after you start it. There is &lt;a href=&quot;/resources/media/2017-11-24-publishing-service-in-docker-container/scripts/get-status.ps1&quot;&gt;get-status.ps1&lt;/a&gt; script that pings the publishing service web site. You can use this script to make sure the IIS web site is started after container is created.&lt;/p&gt;

&lt;h2 id=&quot;service-logging&quot;&gt;Service logging&lt;/h2&gt;
&lt;p&gt;Service command logging is stored in &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;serviceRoot&amp;gt;\logs&lt;/code&gt; directory. Default service root is set to &lt;code class=&quot;highlighter-rouge&quot;&gt;c:\inetpub\wwwroot\sitecorepublishing&lt;/code&gt; folder. Publishing logs are stored in differnt places depending on the mode you choose to run the service in.&lt;br /&gt;
When you execute the service as a console app, the logs are stored in current working dirctory. It’s set to &lt;code class=&quot;highlighter-rouge&quot;&gt;/scripts&lt;/code&gt; in the Dockerfile. However, when you run the service as IIS web site, publishing logs go into &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;serviceRoot&amp;gt;\logs&lt;/code&gt; directory alongside command logs.&lt;/p&gt;

&lt;h2 id=&quot;utility-scripts&quot;&gt;Utility scripts&lt;/h2&gt;
&lt;p&gt;There are several scripts provided for this article.&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;config-pubservice.ps1&lt;/code&gt; - allows to configure connection strings for the publishing service and runs database upgrade command on them. You can overwrite default connection strings or configure connection strings for a different envioronment.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;get-status.ps1&lt;/code&gt; - makes a web request to &lt;code class=&quot;highlighter-rouge&quot;&gt;http://localhost:5001/api/publishing/operations/status&lt;/code&gt; service page. The output of the request is saved into the &lt;code class=&quot;highlighter-rouge&quot;&gt;c:\res\status.txt&lt;/code&gt; file. In case of IIS web site, it starts up the publishing service web site.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;install-iiswebsite.ps1&lt;/code&gt; - installs necessary resources and publishing service as IIS web site. The service is configured to be the default IIS web site running over port 5001.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;set-custom-connbehaviours.ps1&lt;/code&gt; - provides an example how to configure custom connection behaviors and reconfigure connections to use these connection behaviours.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;set-custom-logging.ps1&lt;/code&gt; - example how to set custom logging level for publishing service.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;start-service.ps1&lt;/code&gt; - starts service using Kestrel web server.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;examples-to-create-containers-passing-differnt-parameters&quot;&gt;Examples to create containers passing differnt parameters&lt;/h2&gt;
&lt;p&gt;Here are a few examples how  you can create containers using input scripts.&lt;/p&gt;
&lt;h3 id=&quot;run-container-using-default-configuration&quot;&gt;Run container using default configuration&lt;/h3&gt;
&lt;div class=&quot;language-docker highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker run --rm --name pubsvc pubservice21
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Command creates a container named &lt;code class=&quot;highlighter-rouge&quot;&gt;pubsvc&lt;/code&gt; from image &lt;code class=&quot;highlighter-rouge&quot;&gt;pubservice21&lt;/code&gt; and starts publishing service as console app over port 5001. It starts it because Docker file has instruction &lt;code class=&quot;highlighter-rouge&quot;&gt;CMD [&quot;powershell .\\start-service.ps1&quot;]&lt;/code&gt;.&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;Parameter &lt;code class=&quot;highlighter-rouge&quot;&gt;--rm&lt;/code&gt; instructs docker host to remove container when it stops runnig.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;run-container-and-configure-connection-strings&quot;&gt;Run container and configure connection strings&lt;/h3&gt;
&lt;div class=&quot;language-docker highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker run --rm --name pubsvc pubservice21 powershell &quot;.\\config-pubservice.ps1 -Core '&amp;lt;coreConnectionString&amp;gt;' -Master '&amp;lt;masterConnectionString&amp;gt;' -Web '&amp;lt;webConnectionString&amp;gt;'; .\\start-service.ps1&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Command creates a container and configures connection strings provided in the parameters. Then executes &lt;code class=&quot;highlighter-rouge&quot;&gt;start-service.ps1&lt;/code&gt; script to get the service runing as a console app.&lt;/p&gt;

&lt;h3 id=&quot;run-service-as-iis-web-site&quot;&gt;Run service as IIS web site&lt;/h3&gt;
&lt;div class=&quot;language-docker highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker run --rm --name pubsvc pubservice21 powershell &quot;.\\install-iiswebsite.ps1; .\\get-status.ps1&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Command creates container with publishing service configured as IIS web site. Then invokes &lt;code class=&quot;highlighter-rouge&quot;&gt;get-status.ps1&lt;/code&gt; script to get web site running.&lt;/p&gt;

&lt;h3 id=&quot;reconfigure-running-service&quot;&gt;Reconfigure running service&lt;/h3&gt;
&lt;p&gt;You can execute scripts to re-configure the publishing service when you attach to already running container.&lt;/p&gt;
&lt;div class=&quot;language-docker highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker exec -it pubsvc powershell
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Command attaches to container &lt;code class=&quot;highlighter-rouge&quot;&gt;pubsvc&lt;/code&gt; and opens &lt;code class=&quot;highlighter-rouge&quot;&gt;powershell&lt;/code&gt; console. From here you can navigate around container file system and execute scripts to re-configure the service if needed.&lt;/p&gt;

&lt;h2 id=&quot;gotchas&quot;&gt;Gotchas&lt;/h2&gt;
&lt;p&gt;Some issues I ran into while building and testing the container.&lt;/p&gt;

&lt;h3 id=&quot;copying-files-between-host-and-container&quot;&gt;Copying files between host and container&lt;/h3&gt;
&lt;p&gt;Several times I was not able to copy files into and out of the container until I stopped the container.&lt;/p&gt;

&lt;h3 id=&quot;localhost-mapping&quot;&gt;localhost mapping&lt;/h3&gt;
&lt;p&gt;Windows containers use different approach to configure container network than Linux containers. One outcome of this is that &lt;code class=&quot;highlighter-rouge&quot;&gt;localhost&lt;/code&gt; &lt;a href=&quot;https://github.com/docker/for-win/issues/204&quot;&gt;does not map to Windows container&lt;/a&gt; by default. You can use either direct IP address of the container or utility &lt;a href=&quot;https://github.com/Kymeric/DockerProxy&quot;&gt;DockerProxy&lt;/a&gt;.
Get container IP address:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
docker inspect &lt;span class=&quot;nt&quot;&gt;--format&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}'&lt;/span&gt; &amp;lt;containerId&amp;gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;installing-windows-hosting-sometimes-fails&quot;&gt;Installing windows hosting sometimes fails&lt;/h3&gt;
&lt;p&gt;Several times I got error message while .net core windows hosting was getting installed.&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;hcsshim::ImportLayer failed in Win32: The system cannot find the path specified. (0x3) layerId=\\?\C:\ProgramData\Docker\windowsfilter
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;There seems to be an &lt;a href=&quot;https://github.com/moby/moby/issues/32838&quot;&gt;issue&lt;/a&gt; related to the file system in Windows docker containers. Re-running image build command solved the problem.&lt;/p&gt;

</description>
        <pubDate>Fri, 24 Nov 2017 00:00:00 -0800</pubDate>
        <link>http://localhost:4000/2017-11-24/publishing-service-in-docker-container/</link>
        <guid isPermaLink="true">http://localhost:4000/2017-11-24/publishing-service-in-docker-container/</guid>
        
        <category>sitecore</category>
        
        <category>publishing</category>
        
        <category>docker</category>
        
        
        <category>publishing</category>
        
        <category>containers</category>
        
      </item>
    
      <item>
        <title>Run Solr container in Azure Kubernetes cluster (AKS)</title>
        <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#create-kubernetes-cluster&quot; id=&quot;markdown-toc-create-kubernetes-cluster&quot;&gt;Create Kubernetes cluster&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#create-resource-group-to-host-aks-service&quot; id=&quot;markdown-toc-create-resource-group-to-host-aks-service&quot;&gt;Create resource group to host AKS service&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#generate-ssh-keys-optional&quot; id=&quot;markdown-toc-generate-ssh-keys-optional&quot;&gt;&lt;em&gt;Generate SSH keys [optional]&lt;/em&gt;&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#create-aks-service&quot; id=&quot;markdown-toc-create-aks-service&quot;&gt;Create AKS service&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#install-kubectl-cli&quot; id=&quot;markdown-toc-install-kubectl-cli&quot;&gt;Install kubectl CLI&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#get-aks-credentials&quot; id=&quot;markdown-toc-get-aks-credentials&quot;&gt;Get AKS credentials&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#deploy-solr-container-into-aks-pod&quot; id=&quot;markdown-toc-deploy-solr-container-into-aks-pod&quot;&gt;Deploy Solr container into AKS pod&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#deploy-solr-application-instance&quot; id=&quot;markdown-toc-deploy-solr-application-instance&quot;&gt;Deploy Solr application instance&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#deploy-service-load-balancer-instance&quot; id=&quot;markdown-toc-deploy-service-load-balancer-instance&quot;&gt;Deploy service load balancer instance&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#populate-managed-index-schema&quot; id=&quot;markdown-toc-populate-managed-index-schema&quot;&gt;Populate managed index schema&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#optional-install-self-signed-ssl-cert-into-win-ca-root&quot; id=&quot;markdown-toc-optional-install-self-signed-ssl-cert-into-win-ca-root&quot;&gt;&lt;em&gt;[optional] Install self-signed SSL cert into Win CA root&lt;/em&gt;&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#optional-use-namespaces-for-different-environments&quot; id=&quot;markdown-toc-optional-use-namespaces-for-different-environments&quot;&gt;&lt;em&gt;[optional] Use namespaces for different environments&lt;/em&gt;&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#create-namespace-for-testing-environment&quot; id=&quot;markdown-toc-create-namespace-for-testing-environment&quot;&gt;Create namespace for testing environment&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Consult &lt;a href=&quot;https://kubernetes.io/docs/home/&quot;&gt;Kubernetes documentation&lt;/a&gt; to learn more about it and &lt;code class=&quot;highlighter-rouge&quot;&gt;kubectl&lt;/code&gt; options. Refer to Azure &lt;a href=&quot;https://docs.microsoft.com/en-us/azure/aks/kubernetes-walkthrough&quot;&gt;AKS tutorial&lt;/a&gt; for more details on the service.&lt;br /&gt;
This exercise uses &lt;a href=&quot;https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest&quot;&gt;Azure CLI&lt;/a&gt; commands.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;This exercise assumes you have created a docker image and made it available either through &lt;a href=&quot;/2017-09-25/run-your-container-in-azure/&quot;&gt;Azure ACR&lt;/a&gt; or using other image hosting service.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;All commands in this article were tested using Bash on Windows available in Win 10 Fall Creators Update.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;create-kubernetes-cluster&quot;&gt;Create Kubernetes cluster&lt;/h2&gt;
&lt;p&gt;This step follows instructions from &lt;a href=&quot;https://docs.microsoft.com/en-us/azure/aks/kubernetes-walkthrough&quot;&gt;AKS tutorial&lt;/a&gt; with minor tweaks.&lt;/p&gt;

&lt;h3 id=&quot;create-resource-group-to-host-aks-service&quot;&gt;Create resource group to host AKS service&lt;/h3&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;az group create &lt;span class=&quot;nt&quot;&gt;--name&lt;/span&gt; akstest &lt;span class=&quot;nt&quot;&gt;--location&lt;/span&gt; westus2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;generate-ssh-keys-optional&quot;&gt;&lt;em&gt;Generate SSH keys [optional]&lt;/em&gt;&lt;/h3&gt;
&lt;p&gt;Navigate to &lt;code class=&quot;highlighter-rouge&quot;&gt;.ssh&lt;/code&gt; folder and execute &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh-keygen&lt;/code&gt;. Follow instructions to create ssh keys.&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ssh-keygen &lt;span class=&quot;nt&quot;&gt;-N&lt;/span&gt; P@ssword1 &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; aks_id
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This command will create &lt;code class=&quot;highlighter-rouge&quot;&gt;aks_id&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;aks_id.pub&lt;/code&gt; files.&lt;/p&gt;

&lt;h3 id=&quot;create-aks-service&quot;&gt;Create AKS service&lt;/h3&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;az aks create &lt;span class=&quot;nt&quot;&gt;--resource-group&lt;/span&gt; akstest &lt;span class=&quot;nt&quot;&gt;--name&lt;/span&gt; myK8sCluster &lt;span class=&quot;nt&quot;&gt;--agent-count&lt;/span&gt; 1 &lt;span class=&quot;nt&quot;&gt;--ssh-key-value&lt;/span&gt; ~/.ssh/aks_id.pub
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The command takes several minutes to complete and creates several resources:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Azure service principal for cluster authentication. You can find it in your Azure Active Directory service at App registrations blade. Once there select My Apps to limit output to your account principals.&lt;br /&gt;
The principal gets also added to &lt;code class=&quot;highlighter-rouge&quot;&gt;~/.azure/acsServicePrincipal.json&lt;/code&gt; file.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;myK8sCluster&lt;/code&gt; service that will be added to &lt;code class=&quot;highlighter-rouge&quot;&gt;akstest&lt;/code&gt; group.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;MC_&amp;lt;groupName&amp;gt;_&amp;lt;aksName&amp;gt;_&amp;lt;location&amp;gt;&lt;/code&gt; group with all resources necessary for Managed Kubernetes cluster. In this example it will be &lt;code class=&quot;highlighter-rouge&quot;&gt;MC_akstest_myK8sCluster_westus2&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;install-kubectl-cli&quot;&gt;Install kubectl CLI&lt;/h3&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;az aks install-cli
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;get-aks-credentials&quot;&gt;Get AKS credentials&lt;/h3&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;az aks get-credentials &lt;span class=&quot;nt&quot;&gt;--resource-group&lt;/span&gt; akstest &lt;span class=&quot;nt&quot;&gt;--name&lt;/span&gt; myK8sCluster
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This command will merge Kubernetes cluster configuration into &lt;code class=&quot;highlighter-rouge&quot;&gt;~/.kube/config&lt;/code&gt; file. You can view it by running command:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kubectl config view
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;deploy-solr-container-into-aks-pod&quot;&gt;Deploy Solr container into AKS pod&lt;/h2&gt;
&lt;p&gt;Next step is to deploy application instance (in this example Solr pod) and service instance to allow communication with application pod.&lt;/p&gt;

&lt;h3 id=&quot;deploy-solr-application-instance&quot;&gt;Deploy Solr application instance&lt;/h3&gt;
&lt;p&gt;Creat Kubernetes deployment manifest (&lt;code class=&quot;highlighter-rouge&quot;&gt;solr-app-deployment.yml&lt;/code&gt;) with the following content. Make sure to modify &lt;code class=&quot;highlighter-rouge&quot;&gt;image&lt;/code&gt; parameter to point to your container image.&lt;/p&gt;
&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;apps/v1beta1&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Deployment&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;solr-app&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;replicas&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;1&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;solr-app&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;solr-app&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;myregistry.azurecr.io/solrssl-flex:6.6.0&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;create-basic-cores.sh&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;containerPort&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;8983&lt;/span&gt;
          &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;solr&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Deploy manafest using &lt;code class=&quot;highlighter-rouge&quot;&gt;kubectl&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kubectl apply &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; ./solr-app-deployment.yml
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Verify that deployment is created:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kubectl get deployment
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Verify that pod for solr application is created and running:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kubectl get pods
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If pod gets an error, you can try to access its logs:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kubectl logs &amp;lt;podName&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;deploy-service-load-balancer-instance&quot;&gt;Deploy service load balancer instance&lt;/h3&gt;
&lt;p&gt;Create manifest file to describe service instance &lt;code class=&quot;highlighter-rouge&quot;&gt;solr-service.yml&lt;/code&gt;. Type &lt;code class=&quot;highlighter-rouge&quot;&gt;LoadBalancer&lt;/code&gt; creates an external IP for the service so that you can access it from outside of AKS.&lt;/p&gt;
&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;v1&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Service&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;solr-app&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;solr-app&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;tier&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;frontend&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;LoadBalancer&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;8983&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;targetPort&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;8983&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;solr-app&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Deploy service into AKS cluster.&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kubectl apply &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; ./solr-service.yml
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Verify that service is up and running and has external IP:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kubectl get services
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;populate-managed-index-schema&quot;&gt;Populate managed index schema&lt;/h2&gt;
&lt;p&gt;Sitecore 9 requires managed-schema to be populated with fields before you can start indexing Sitecore items. You can do this by calling &lt;code class=&quot;highlighter-rouge&quot;&gt;/sitecore/admin/PopulateManagedSchema.aspx?indexes=all&lt;/code&gt; service page.&lt;/p&gt;

&lt;h2 id=&quot;optional-install-self-signed-ssl-cert-into-win-ca-root&quot;&gt;&lt;em&gt;[optional] Install self-signed SSL cert into Win CA root&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;This step is necessary if you use &lt;a href=&quot;/2017-09-24/flexible-solr-container-image-for-sitecore/&quot;&gt;Solr image that creates self-signed SSL cert&lt;/a&gt;. 
Copy SSL cert from pod into your local machine:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kubectl cp &amp;lt;podName&amp;gt;:/opt/solr/server/etc/solr-ssl.keystore.jks ~/solr-ssl.keystore.jks
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Copy cert from Ubuntu on Windows to your Windows (WLS) file system:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cp ~/solr-ssl.keystore.jks /mnt/c/temp/solr-ssl.keystore.jks
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Install SSL cert into Windows CA root using &lt;a href=&quot;https://gist.github.com/ivansharamok/6d22cde83944117c349d247137f10100&quot;&gt;install-solrssl.ps1&lt;/a&gt; PS script.&lt;/p&gt;

&lt;h2 id=&quot;optional-use-namespaces-for-different-environments&quot;&gt;&lt;em&gt;[optional] Use namespaces for different environments&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;By default everything you create in your AKS cluster goes into &lt;code class=&quot;highlighter-rouge&quot;&gt;default&lt;/code&gt; namespace. Kubernetes allows to isolate or group resources through &lt;a href=&quot;https://kubernetes.io/docs/tasks/administer-cluster/namespaces-walkthrough/&quot;&gt;namespaces&lt;/a&gt;.&lt;/p&gt;
&lt;h3 id=&quot;create-namespace-for-testing-environment&quot;&gt;Create namespace for testing environment&lt;/h3&gt;
&lt;p&gt;Create manifest file (&lt;code class=&quot;highlighter-rouge&quot;&gt;namespace-testing.json&lt;/code&gt;) that describes &lt;code class=&quot;highlighter-rouge&quot;&gt;testing&lt;/code&gt; namespace.&lt;/p&gt;
&lt;div class=&quot;language-json highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;kind&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Namespace&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;apiVersion&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;v1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;metadata&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;testing&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;labels&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;playground&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Deploy &lt;code class=&quot;highlighter-rouge&quot;&gt;testing&lt;/code&gt; namespace into AKS cluster:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kubectl create &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; namespace-testing.json
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;View available namespaces in your AKS cluster:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kubectl get namespace &lt;span class=&quot;nt&quot;&gt;--show-labels&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Now you can deploy apps and services into testing namespace of you AKS cluster by adding &lt;code class=&quot;highlighter-rouge&quot;&gt;--namespace testing&lt;/code&gt; parameter to &lt;code class=&quot;highlighter-rouge&quot;&gt;kubectl&lt;/code&gt; command.&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kubectl apply &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; ./solr-app-deployment.yml &lt;span class=&quot;nt&quot;&gt;--namespace&lt;/span&gt; testing
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

</description>
        <pubDate>Tue, 07 Nov 2017 00:00:00 -0800</pubDate>
        <link>http://localhost:4000/2017-11-07/run-solr-container-in-azure-kubernetes-cluster/</link>
        <guid isPermaLink="true">http://localhost:4000/2017-11-07/run-solr-container-in-azure-kubernetes-cluster/</guid>
        
        <category>indexing</category>
        
        <category>docker</category>
        
        <category>kubernetes</category>
        
        
        <category>solr</category>
        
        <category>containers</category>
        
        <category>azure</category>
        
      </item>
    
      <item>
        <title>Run your container in Azure</title>
        <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#create-azure-container-registry&quot; id=&quot;markdown-toc-create-azure-container-registry&quot;&gt;Create Azure Container Registry&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#tag-image-to-be-pushed-into-acr&quot; id=&quot;markdown-toc-tag-image-to-be-pushed-into-acr&quot;&gt;Tag image to be pushed into ACR&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#push-image-into-acr&quot; id=&quot;markdown-toc-push-image-into-acr&quot;&gt;Push image into ACR&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#create-azure-container-instance-from-acr-image&quot; id=&quot;markdown-toc-create-azure-container-instance-from-acr-image&quot;&gt;Create Azure Container Instance from ACR image&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;I can run &lt;a href=&quot;/2017-09-20/run-solr+ssl-in-docker-container-with-sitecore-indexes/&quot;&gt;Solr+SSL docker container&lt;/a&gt; and a bit more &lt;a href=&quot;/2017-09-24/flexible-solr-container-image-for-sitecore/&quot;&gt;flexible Solr+SSL container&lt;/a&gt; with Sitecore indexes on my local machine. In this exercise I push my local Docker image into &lt;a href=&quot;https://azure.microsoft.com/en-us/services/container-registry/&quot;&gt;Azure Container Registry&lt;/a&gt; (ACR) and then create &lt;a href=&quot;https://azure.microsoft.com/en-us/services/container-instances/&quot;&gt;Azure Container Instance&lt;/a&gt; (ACI) to run my container in Azure.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;You need &lt;a href=&quot;https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest&quot;&gt;Azure CLI&lt;/a&gt; 2.0 to run scripts in this article. The version should be &amp;gt;= 2.0.13.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;I used &lt;a href=&quot;https://docs.microsoft.com/en-us/azure/container-instances/container-instances-tutorial-prepare-app&quot;&gt;this tutorial&lt;/a&gt; to experiment with ACR and ACI.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;create-azure-container-registry&quot;&gt;Create Azure Container Registry&lt;/h2&gt;
&lt;p&gt;First, create ACR in your Azure subscription to hold your container images.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-azure-cli&quot;&gt;az acr create -n myregistry -g mygroup --location westcentralus --sku Managed_Basic --admin-enabled true
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
  &lt;p&gt;Complete PowerShell script &lt;a href=&quot;https://gist.github.com/ivansharamok/15692dcfb9ed03552d9e0ebb30d089ca&quot;&gt;create-acr.ps1&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;At the time I used Azure containers not all regions supported Managed sku options. Most regions have &lt;code class=&quot;highlighter-rouge&quot;&gt;Basic&lt;/code&gt; (a.k.a. Classic) storage for ACR which is tied to a storage account. If you want to use Managed storage, then explore which regions support it. I found a few: &lt;code class=&quot;highlighter-rouge&quot;&gt;eastus&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;westcentralus&lt;/code&gt;.&lt;br /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;Basic&lt;/code&gt; (Classic) storage option for ACR does not allow to delete uploaded images. &lt;code class=&quot;highlighter-rouge&quot;&gt;Managed&lt;/code&gt; options didn’t seem to have this limitation.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Once the registry is created its full name should be &lt;code class=&quot;highlighter-rouge&quot;&gt;myregistry.azurecr.io&lt;/code&gt;.&lt;/p&gt;

&lt;h2 id=&quot;tag-image-to-be-pushed-into-acr&quot;&gt;Tag image to be pushed into ACR&lt;/h2&gt;
&lt;p&gt;To upload a container image into your ACR, you have to tag it with full ACR name first. I used &lt;a href=&quot;/2017-09-24/flexible-solr-container-image-for-sitecore/&quot;&gt;flexible Solr+SSL&lt;/a&gt; image for this.&lt;/p&gt;
&lt;div class=&quot;language-docker highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker tag solrssl-flex:6.6.0 myregistry.azurecr.io/solrssl-flex:6.6.0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Run &lt;code class=&quot;highlighter-rouge&quot;&gt;docker images&lt;/code&gt; to make sure your new tagged image is listed.&lt;/p&gt;

&lt;h2 id=&quot;push-image-into-acr&quot;&gt;Push image into ACR&lt;/h2&gt;
&lt;p&gt;This is done by means of &lt;code class=&quot;highlighter-rouge&quot;&gt;docker push&lt;/code&gt; command.&lt;/p&gt;
&lt;div class=&quot;language-docker highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker push myregistry.azurecr.io/solrssl-flex:6.6.0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;blockquote&gt;
  &lt;p&gt;Complete PowerShell script example &lt;a href=&quot;https://gist.github.com/ivansharamok/acc36673c1be6d73c32fb87472674001&quot;&gt;push-image2acr.ps1&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;create-azure-container-instance-from-acr-image&quot;&gt;Create Azure Container Instance from ACR image&lt;/h2&gt;
&lt;p&gt;To create container instance in Azure from ACR image run this command:&lt;/p&gt;
&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$acrPwd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;az acr credential show -n myregistry --query &lt;span class=&quot;s2&quot;&gt;&quot;passwords[0].value&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;
az container create -g mygroup -n mysolr --image myregistry.azurecr.io/solrssl-flex:6.6.0 --cpu 1 --memory 1.5 --registry-password &lt;span class=&quot;nv&quot;&gt;$acrPwd&lt;/span&gt; --ip-address public --port 8983
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;blockquote&gt;
  &lt;p&gt;If you want to pass a command line to be executed at the time container instance is created you can that via ` –command-line ‘my-script.sh’` parameter.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;Complete PowerShell script &lt;a href=&quot;https://gist.github.com/ivansharamok/7bd14e3c9b733f3c1a607a725d42c433&quot;&gt;deploy-aci-from-acr.ps1&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;

</description>
        <pubDate>Mon, 25 Sep 2017 00:00:00 -0700</pubDate>
        <link>http://localhost:4000/2017-09-25/run-your-container-in-azure/</link>
        <guid isPermaLink="true">http://localhost:4000/2017-09-25/run-your-container-in-azure/</guid>
        
        <category>indexing</category>
        
        <category>docker</category>
        
        
        <category>solr</category>
        
        <category>containers</category>
        
        <category>azure</category>
        
      </item>
    
      <item>
        <title>Flexible Solr container image for Sitecore</title>
        <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#problem-and-solution&quot; id=&quot;markdown-toc-problem-and-solution&quot;&gt;Problem and solution&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#prepare-docker-image&quot; id=&quot;markdown-toc-prepare-docker-image&quot;&gt;Prepare Docker image&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#input-scripts&quot; id=&quot;markdown-toc-input-scripts&quot;&gt;Input scripts&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#create-basic-cores&quot; id=&quot;markdown-toc-create-basic-cores&quot;&gt;Create basic cores&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#script-for-sitecore-7x-and-8x&quot; id=&quot;markdown-toc-script-for-sitecore-7x-and-8x&quot;&gt;Script for Sitecore 7.x and 8.x&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#script-for-sitecore-9&quot; id=&quot;markdown-toc-script-for-sitecore-9&quot;&gt;Script for Sitecore 9&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#create-cores-based-on-predefined-configufation&quot; id=&quot;markdown-toc-create-cores-based-on-predefined-configufation&quot;&gt;Create cores based on predefined configufation&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#utility-script&quot; id=&quot;markdown-toc-utility-script&quot;&gt;&lt;em&gt;Utility script&lt;/em&gt;&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#gotchas-i-ran-into&quot; id=&quot;markdown-toc-gotchas-i-ran-into&quot;&gt;&lt;em&gt;Gotchas I ran into&lt;/em&gt;&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#set-permissions-explicitly-in-dockerfile&quot; id=&quot;markdown-toc-set-permissions-explicitly-in-dockerfile&quot;&gt;Set permissions explicitly in Dockerfile&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#ensure-correct-end-of-line-sequence-lf-vs-crlf&quot; id=&quot;markdown-toc-ensure-correct-end-of-line-sequence-lf-vs-crlf&quot;&gt;Ensure correct end of line sequence (LF vs CRLF)&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#examples-to-create-solr-containers-with-various-sitecore-index-configurations&quot; id=&quot;markdown-toc-examples-to-create-solr-containers-with-various-sitecore-index-configurations&quot;&gt;Examples to create Solr containers with various Sitecore index configurations&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#create-sitecore-indexes-using-all-default-input-parameters&quot; id=&quot;markdown-toc-create-sitecore-indexes-using-all-default-input-parameters&quot;&gt;Create Sitecore indexes using all default input parameters&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#create-sitecore-indexes-for-xm-configuration-only-with-specified-core-prefix-and-specified-schemaxml-file&quot; id=&quot;markdown-toc-create-sitecore-indexes-for-xm-configuration-only-with-specified-core-prefix-and-specified-schemaxml-file&quot;&gt;Create Sitecore indexes for xm configuration only with specified core prefix and specified schema.xml file&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#create-sitecore-index-for-xp-configuration-only-using-provided-sorl-configuration-path&quot; id=&quot;markdown-toc-create-sitecore-index-for-xp-configuration-only-using-provided-sorl-configuration-path&quot;&gt;Create Sitecore index for xp configuration only using provided Sorl configuration path&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;In article &lt;a href=&quot;/2017-09-20/run-solr+ssl-in-docker-container-with-sitecore-indexes/&quot;&gt;Solr + SSL in docker container&lt;/a&gt; I described how to build an image that always creates exactly same container configuration. That’s ideal for environments where configuration is imutable. However, for mutable environments (e.g. development) I want to be able to run different configurations but may not want to build many docker images to support them. This example provides an option how to get a bit more flexible container image to run Solr with Sitecore indexes in a container.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;TL;TR
Skip all the blabber and go straight to resources:&lt;/p&gt;
  &lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;/resources/media/2017-09-24-flexible-solr-container-image-for-sitecore/Dockerfile&quot;&gt;Dockerfile&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;/resources/media/2017-09-24-flexible-solr-container-image-for-sitecore/res/scripts/create-basic-cores.sh&quot;&gt;create-basic-cores.sh Sitecore 8&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;/resources/media/2017-09-24-flexible-solr-container-image-for-sitecore/res/scripts/create-basic-cores-sc9.sh&quot;&gt;create-basic-cores.sh Sitecore 9&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;/resources/media/2017-09-24-flexible-solr-container-image-for-sitecore/res/scripts/create-config-cores.sh&quot;&gt;create-config-cores.sh&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;/resources/media/2017-09-24-flexible-solr-container-image-for-sitecore/res/scripts/create-core.sh&quot;&gt;create-core.sh&lt;/a&gt;&lt;/li&gt;
  &lt;/ul&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;This article assumes the following folder configuration structure for docker build directory:&lt;/p&gt;
  &lt;ul&gt;
    &lt;li&gt;/build_dir
      &lt;ul&gt;
        &lt;li&gt;Dockerfile&lt;/li&gt;
        &lt;li&gt;/res
          &lt;ul&gt;
            &lt;li&gt;/configs
              &lt;ul&gt;
                &lt;li&gt;/xm
                  &lt;ul&gt;
                    &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;schema.xml&lt;/code&gt;&lt;/li&gt;
                    &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;solrconfi.xml&lt;/code&gt;&lt;/li&gt;
                  &lt;/ul&gt;
                &lt;/li&gt;
                &lt;li&gt;/xdb
                  &lt;ul&gt;
                    &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;managed-schema&lt;/code&gt;&lt;/li&gt;
                  &lt;/ul&gt;
                &lt;/li&gt;
              &lt;/ul&gt;
            &lt;/li&gt;
            &lt;li&gt;/scripts
              &lt;ul&gt;
                &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;create-basic-cores.sh&lt;/code&gt;&lt;/li&gt;
                &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;create-basic-cores-sc9.sh&lt;/code&gt;&lt;/li&gt;
                &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;create-config-cores.sh&lt;/code&gt;&lt;/li&gt;
                &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;create-core.sh&lt;/code&gt;&lt;/li&gt;
              &lt;/ul&gt;
            &lt;/li&gt;
          &lt;/ul&gt;
        &lt;/li&gt;
      &lt;/ul&gt;
    &lt;/li&gt;
  &lt;/ul&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;problem-and-solution&quot;&gt;Problem and solution&lt;/h2&gt;
&lt;p&gt;In my local dev environment I run multiple Sitecore applications that require Solr indexes. Each application has its own set of indexes which may have unique names or configurations. To simplify management of Solr containers to serve different Solr index configurations, I decided to create a docker image that I can pass input parameters to manipulate container state configuration just enough to get me a set of fresh Solr indexes with desired configuration.&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;I don’t recommed this for production container images. I believe for prod images container configuration can be mutated only at image level.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;My solution here is to provide an option to pass a script with parameters to create a container instance. As I shift away from a determined configuration at container image level to container instance, I have to account for container instance state in my scripts. In my example that’s to make sure I don’t re-create indexes every time a container is stopped and then started. That’s because each time you start a contanier instance, it executes input parameters that it received as the instance was created in the first place.&lt;/p&gt;

&lt;h2 id=&quot;prepare-docker-image&quot;&gt;Prepare Docker image&lt;/h2&gt;
&lt;p&gt;In this example I moved the part that pre-created Solr index cores described in &lt;a href=&quot;/2017-09-20/run-solr+ssl-in-docker-container-with-sitecore-indexes/&quot;&gt;Solr + SSL in docker container&lt;/a&gt; article and moved it to shell script.&lt;/p&gt;

&lt;h3 id=&quot;input-scripts&quot;&gt;Input scripts&lt;/h3&gt;
&lt;p&gt;I created 2 shell scripts to provide options to create Solr cores. One allows me to create cores with these parameters:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;specified Sitecore confiruation type (xm, xp, xp!)
    &lt;ul&gt;
      &lt;li&gt;xm - content search cores only (core, master, web, etc.)&lt;/li&gt;
      &lt;li&gt;xp - content search + xdb cores&lt;/li&gt;
      &lt;li&gt;xp! - xdb cores only&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;specified core prefix (i.e. myprefix_core_index, myprefix_master_index, etc.)&lt;/li&gt;
  &lt;li&gt;specified &lt;code class=&quot;highlighter-rouge&quot;&gt;schema&lt;/code&gt; (e.g. /shema.xml) file should be used. &lt;em&gt;When &lt;code class=&quot;highlighter-rouge&quot;&gt;xm&lt;/code&gt; or &lt;code class=&quot;highlighter-rouge&quot;&gt;xp&lt;/code&gt; configuration type is used, provides path to schema file for content search cores &lt;strong&gt;only&lt;/strong&gt;&lt;/em&gt;. The &lt;code class=&quot;highlighter-rouge&quot;&gt;xp&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;xp!&lt;/code&gt; configuration types use &lt;code class=&quot;highlighter-rouge&quot;&gt;schema&lt;/code&gt; from &lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/res/configs/xp/managed-schema&lt;/code&gt; path.&lt;/li&gt;
  &lt;li&gt;specified &lt;code class=&quot;highlighter-rouge&quot;&gt;solrconfig&lt;/code&gt; file should be used. &lt;em&gt;Used for content search cores &lt;strong&gt;only&lt;/strong&gt;&lt;/em&gt;.
    &lt;blockquote&gt;
      &lt;p&gt;Explore scipts to see their efault parameters.&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;create-basic-cores&quot;&gt;Create basic cores&lt;/h3&gt;
&lt;p&gt;This script creates Solr cores according to specified configuration type based on &lt;code class=&quot;highlighter-rouge&quot;&gt;basic_configs&lt;/code&gt; configset and provides options to set core prefixes, custom &lt;code class=&quot;highlighter-rouge&quot;&gt;schema&lt;/code&gt; (e.g. &lt;code class=&quot;highlighter-rouge&quot;&gt;/res/configs/xm/my-schema.xml&lt;/code&gt; or &lt;code class=&quot;highlighter-rouge&quot;&gt;/res/configs/xm/my-managed-schema&lt;/code&gt;) file and custom &lt;code class=&quot;highlighter-rouge&quot;&gt;solrconfig&lt;/code&gt; (e.g. &lt;code class=&quot;highlighter-rouge&quot;&gt;/res/configs/my-solrconfig.xml&lt;/code&gt;) file.&lt;/p&gt;
&lt;h4 id=&quot;script-for-sitecore-7x-and-8x&quot;&gt;Script for Sitecore 7.x and 8.x&lt;/h4&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# set variables&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;configpath&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'/opt/res/configs/xm'&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;coresdir&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/opt/solr/server/solr/mycores&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;configsource&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'/opt/solr/server/solr/configsets/basic_configs'&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;CONFIG_TYPE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;:-&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'xp'&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;CORE_PREFIX&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;:-&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'sitecore'&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;SCHEMA&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;:-&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$configpath&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/schema.xml&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;SOLRCONFIG&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;:-&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$configpath&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/solrconfig.xml&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-z&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$SOLR_HOME&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
    &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;coresdir&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/opt/solr/server/solr/mycores&quot;&lt;/span&gt;
    mkdir &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$coresdir&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;else
    &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;coresdir&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$SOLR_HOME&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;fi

if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'xp!'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$CONFIG_TYPE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;# array of xm core names&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;declare&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-a&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;cores&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CORE_PREFIX&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;_core_index&quot;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CORE_PREFIX&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;_master_index&quot;&lt;/span&gt; 
                        &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CORE_PREFIX&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;_web_index&quot;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CORE_PREFIX&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;_marketingdefinitions_master&quot;&lt;/span&gt;
                        &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CORE_PREFIX&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;_marketingdefinitions_web&quot;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CORE_PREFIX&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;_marketing_asset_index_master&quot;&lt;/span&gt;
                        &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CORE_PREFIX&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;_marketing_asset_index_web&quot;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CORE_PREFIX&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;_testing_index&quot;&lt;/span&gt;
                        &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CORE_PREFIX&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;_suggested_test_index&quot;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CORE_PREFIX&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;_fxm_master_index&quot;&lt;/span&gt;
                        &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CORE_PREFIX&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;_fxm_web_index&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;# create xm cores&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;core &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;cores&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[@]&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
        /opt/res/scripts/create-core.sh &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;core&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
        cp &lt;span class=&quot;nv&quot;&gt;$SCHEMA&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;coresdir&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;/&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;core&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;/conf/schema.xml
        cp &lt;span class=&quot;nv&quot;&gt;$SOLRCONFIG&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;coresdir&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;/&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;core&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;/conf/solrconfig.xml
    &lt;span class=&quot;k&quot;&gt;done
fi&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# run this block only for xp || xp! configuration types&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'xp'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$CONFIG_TYPE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'xp!'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$CONFIG_TYPE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;# array of xdb core names&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;declare&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-a&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;xcores&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CORE_PREFIX&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;_xdb&quot;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CORE_PREFIX&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;_xdb_rebuild&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;xcore &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;xcores&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[@]&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
        /opt/res/scripts/create-core.sh &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;xcore&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
        cp /opt/res/configs/xdb/managed-schema &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;coresdir&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;/&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;xcore&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;/conf/managed-schema
    &lt;span class=&quot;k&quot;&gt;done
fi&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;script-for-sitecore-9&quot;&gt;Script for Sitecore 9&lt;/h4&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;configpath&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'/opt/res/configs/xm'&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;coresdir&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/opt/solr/server/solr/mycores&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;configsource&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'/opt/solr/server/solr/configsets/basic_configs'&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;CONFIG_TYPE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;:-&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'xp'&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;CORE_PREFIX&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;:-&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'sitecore'&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# do not set default shema path as Sitecore 9.0 and up uses managed-schema file&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;SCHEMA&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# data_driven_schema_configs has add-unknown-fields-to-the-schema processor enabled by default which is required for managed-schema&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;SOLRCONFIG&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;:-&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'/opt/solr/server/solr/configsets/data_driven_schema_configs/conf/solrconfig.xml'&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;UNIQUEID&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;:-&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;_uniqueid&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;FIELDIDTOREPLACE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;:-&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;id&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-z&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$SOLR_HOME&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
    &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;coresdir&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/opt/solr/server/solr/mycores&quot;&lt;/span&gt;
    mkdir &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$coresdir&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;else
    &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;coresdir&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$SOLR_HOME&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;fi

if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'xp!'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$CONFIG_TYPE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;# array of xm core names&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;declare&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-a&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;cores&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CORE_PREFIX&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;_core_index&quot;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CORE_PREFIX&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;_master_index&quot;&lt;/span&gt; 
                        &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CORE_PREFIX&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;_web_index&quot;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CORE_PREFIX&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;_marketingdefinitions_master&quot;&lt;/span&gt;
                        &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CORE_PREFIX&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;_marketingdefinitions_web&quot;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CORE_PREFIX&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;_marketing_asset_index_master&quot;&lt;/span&gt;
                        &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CORE_PREFIX&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;_marketing_asset_index_web&quot;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CORE_PREFIX&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;_testing_index&quot;&lt;/span&gt;
                        &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CORE_PREFIX&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;_suggested_test_index&quot;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CORE_PREFIX&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;_fxm_master_index&quot;&lt;/span&gt;
                        &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CORE_PREFIX&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;_fxm_web_index&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;# create xm cores&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;uniquefield&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;field name=&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$UNIQUEID&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; type=&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; indexed=&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; stored=&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; required=&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; multiValued=&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; /&amp;gt;&quot;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;core &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;cores&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[@]&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
        /opt/res/scripts/create-core.sh &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;core&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-z&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$SCHEMA&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
            &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;copying &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$SCHEMA&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; to &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;coresdir&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;core&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/conf/managed-schema&quot;&lt;/span&gt;
            cp &lt;span class=&quot;nv&quot;&gt;$SCHEMA&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;coresdir&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;/&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;core&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;/conf/managed-schema
        &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
            &lt;span class=&quot;c&quot;&gt;# update schema file unique key&lt;/span&gt;
            &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;changing &amp;lt;field name=&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$FIELDIDTOREPLACE&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;... /&amp;gt;&quot;&lt;/span&gt;
            sed &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;s|&amp;lt;field name=&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$FIELDIDTOREPLACE&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;.*&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$|$uniquefield&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;|&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;coresdir&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;/&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;core&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;/conf/managed-schema
            &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;changing &amp;lt;uniqueKey&amp;gt;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$FIELDIDTOREPLACE&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;lt;/uniqueKey&amp;gt;&quot;&lt;/span&gt;
            sed &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;s|&amp;lt;uniqueKey&amp;gt;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$FIELDIDTOREPLACE&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;lt;/uniqueKey&amp;gt;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$|&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;lt;uniqueKey&amp;gt;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$UNIQUEID&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;lt;/uniqueKey&amp;gt;|&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;coresdir&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;/&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;core&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;/conf/managed-schema
        &lt;span class=&quot;k&quot;&gt;fi
        if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-z&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$SOLRCONFIG&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
            &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;copying &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$SOLRCONFIG&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; to &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;coresdir&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;core&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/conf/solrconfig.xml&quot;&lt;/span&gt;
            cp &lt;span class=&quot;nv&quot;&gt;$SOLRCONFIG&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;coresdir&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;/&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;core&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;/conf/solrconfig.xml
        &lt;span class=&quot;k&quot;&gt;fi

    done
fi&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# run this block only for xp || xp! configuration types&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'xp'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$CONFIG_TYPE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'xp!'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$CONFIG_TYPE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;# array of xdb core names&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;declare&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-a&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;xcores&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CORE_PREFIX&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;_xdb&quot;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CORE_PREFIX&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;_xdb_rebuild&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;xcore &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;xcores&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[@]&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
        /opt/res/scripts/create-core.sh &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;xcore&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
        cp /opt/res/configs/xdb/managed-schema &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;coresdir&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;/&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;xcore&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;/conf/managed-schema
    &lt;span class=&quot;k&quot;&gt;done
fi&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Get full code for &lt;a href=&quot;/resources/media/2017-09-24-flexible-solr-container-image-for-sitecore/res/scripts/create-basic-cores.sh&quot;&gt;create-basic-cores.sh Sitecore 8&lt;/a&gt; script.&lt;br /&gt;
Get full code for &lt;a href=&quot;/resources/media/2017-09-24-flexible-solr-container-image-for-sitecore/res/scripts/create-basic-cores-sc9.sh&quot;&gt;create-basic-cores-sc9.sh Sitecore 9&lt;/a&gt; script.&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;Sitecore 9 requires managed-schema to be populated with fields before you can start indexing Sitecore items. You can do this by calling &lt;code class=&quot;highlighter-rouge&quot;&gt;/sitecore/admin/PopulateManagedSchema.aspx?indexes=all&lt;/code&gt; service page.&lt;br /&gt;
As an alternative run &lt;a href=&quot;https://gist.github.com/ivansharamok/48ce60475d176511eeae16bf254e6dea&quot;&gt;this script&lt;/a&gt; after you spin up a new container with fresh Sitecore 9 indexes.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;create-cores-based-on-predefined-configufation&quot;&gt;Create cores based on predefined configufation&lt;/h3&gt;
&lt;p&gt;Default configset &lt;code class=&quot;highlighter-rouge&quot;&gt;basic_configs&lt;/code&gt; is a quick way to create a bare bone Solr core. However, a project may require custom Solr core configuraiton with custom stopwords or several languages or else. For this purpose I made another script that creates Solr cores using path that contains custom configuration.&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# set variables&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;configpath&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'/opt/res/configs'&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;coresdir&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/opt/solr/server/solr/mycores&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;configsource&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'/opt/solr/server/solr/configsets/basic_configs'&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;CONFIG_TYPE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;:-&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'xp'&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;CORE_PREFIX&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;:-&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'sitecore'&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;CONFIG_DIR&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-z&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$SOLR_HOME&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
    &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;coresdir&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/opt/solr/server/solr/mycores&quot;&lt;/span&gt;
    mkdir &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$coresdir&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;else
    &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;coresdir&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$SOLR_HOME&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;fi&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# if config dir is not provide use basic_configs&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-z&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$CONFIG_DIR&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
    &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CONFIG_DIR&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$configsource&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;fi&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# array of xm core names&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'xp!'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$CONFIG_TYPE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
    &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;declare&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-a&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;cores&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CORE_PREFIX&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;_core_index&quot;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CORE_PREFIX&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;_master_index&quot;&lt;/span&gt; 
                        &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CORE_PREFIX&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;_web_index&quot;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CORE_PREFIX&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;_marketingdefinitions_master&quot;&lt;/span&gt;
                        &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CORE_PREFIX&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;_marketingdefinitions_web&quot;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CORE_PREFIX&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;_marketing_asset_index_master&quot;&lt;/span&gt;
                        &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CORE_PREFIX&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;_marketing_asset_index_web&quot;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CORE_PREFIX&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;_testing_index&quot;&lt;/span&gt;
                        &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CORE_PREFIX&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;_suggested_test_index&quot;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CORE_PREFIX&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;_fxm_master_index&quot;&lt;/span&gt;
                        &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CORE_PREFIX&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;_fxm_web_index&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;# create xm cores&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;core &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;cores&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[@]&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
        /opt/res/scripts/create-core.sh &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;core&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CONFIG_DIR&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;}&quot;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;done
fi&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# run this block only for xp || xp! configuration types&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'xp'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$CONFIG_TYPE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'xp!'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$CONFIG_TYPE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;# array of xdb core names&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;declare&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-a&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;xcores&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CORE_PREFIX&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;_xdb&quot;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CORE_PREFIX&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;_xdb_rebuild&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;xcore &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;xcores&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[@]&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
        /opt/res/scripts/create-core.sh &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;xcore&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CONFIG_DIR&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;done
fi&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Get full code for &lt;a href=&quot;/resources/media/2017-09-24-flexible-solr-container-image-for-sitecore/res/scripts/create-config-cores.sh&quot;&gt;create-config-cores.sh&lt;/a&gt; script.&lt;/p&gt;

&lt;h3 id=&quot;utility-script&quot;&gt;&lt;em&gt;Utility script&lt;/em&gt;&lt;/h3&gt;
&lt;p&gt;To facilitate index core creation, I use &lt;a href=&quot;/resources/media/2017-09-24-flexible-solr-container-image-for-sitecore/res/scripts/create-core.sh&quot;&gt;create-core.sh&lt;/a&gt; script. That’s where I check for core’s existance before I create one.&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# set core variables&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;CORE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;:-&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;gettingstarted&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;CONFIG_SOURCE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;:-&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'/opt/solr/server/solr/configsets/basic_configs'&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-z&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$SOLR_HOME&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
    &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;coresdir&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/opt/solr/server/solr/mycores&quot;&lt;/span&gt;
    mkdir &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$coresdir&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;else
    &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;coresdir&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$SOLR_HOME&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;fi&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# create cores from /configsets/basic_configs&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;coredir&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$coresdir&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$CORE&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$coredir&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
    &lt;/span&gt;cp &lt;span class=&quot;nt&quot;&gt;-r&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$CONFIG_SOURCE&lt;/span&gt;/ &lt;span class=&quot;nv&quot;&gt;$coredir&lt;/span&gt;
    touch &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$coredir&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/core.properties&quot;&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;created &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$coredir&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;else
    &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;core &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$CORE&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; already exists&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;fi&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;gotchas-i-ran-into&quot;&gt;&lt;em&gt;Gotchas I ran into&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;A few pitfalls I ran into while using Docker on Windows and Mac.&lt;/p&gt;

&lt;h3 id=&quot;set-permissions-explicitly-in-dockerfile&quot;&gt;Set permissions explicitly in Dockerfile&lt;/h3&gt;
&lt;p&gt;An issue I ran into was the difference in permissions that get assigned to the files when you copy them from local Windows vs Mac OS into docker image. Files copied from Win OS get elevated permissions while files copied from Mac have to be assigned proper permissions to perform necessary actions on them (e.g. execute a shell script). To execute scipts you need &lt;code class=&quot;highlighter-rouge&quot;&gt;chmod +x&lt;/code&gt; or &lt;code class=&quot;highlighter-rouge&quot;&gt;chmod 700&lt;/code&gt; permission assigned to shell scripts. Here are instructions in the Dockerfile I had to set the proper permission level:&lt;/p&gt;
&lt;div class=&quot;language-docker highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# use root user to set permissions&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;USER&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; root&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# other instructions here. See full Dockerfile for more details.&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# copy local res directory to /opt/res path in docker image&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;COPY&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; res /opt/res&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# set $SOLR_USER (this variable is a part of original image) ownership for /opt/res path and its contents&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;RUN &lt;/span&gt;chown &lt;span class=&quot;nt&quot;&gt;-R&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$SOLR_USER&lt;/span&gt;:&lt;span class=&quot;nv&quot;&gt;$SOLR_USER&lt;/span&gt; /opt/res
&lt;span class=&quot;c&quot;&gt;# set executable permission for /opt/res contents&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;RUN &lt;/span&gt;chmod &lt;span class=&quot;nt&quot;&gt;-R&lt;/span&gt; 700 /opt/res
&lt;span class=&quot;c&quot;&gt;# set user back to $SOLR_USER&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;USER&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; $SOLR_USER&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;ensure-correct-end-of-line-sequence-lf-vs-crlf&quot;&gt;Ensure correct end of line sequence (LF vs CRLF)&lt;/h3&gt;
&lt;p&gt;Since I used Linux based Docker images and run shell scripts in them, I have to make sure my scripts use LF end of line sequence. That’s easy to miss when writing shell scripts on Windows. Any modern text editor can change that. To name a few &lt;code class=&quot;highlighter-rouge&quot;&gt;VS Code&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;Nodepad++&lt;/code&gt;.
One indication you forgot to set proper end of line sequence is this error when you create a container that executes a script:&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Executing /opt/res/scripts/create-basic-cores.sh xm giddyup
/opt/res/scripts/create-basic-cores.sh: /opt/res/scripts/create-core.sh: /bin/bash^M: bad interpreter: No such file or directory
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;examples-to-create-solr-containers-with-various-sitecore-index-configurations&quot;&gt;Examples to create Solr containers with various Sitecore index configurations&lt;/h2&gt;
&lt;p&gt;Here are a few examples how  you can create containers using input scripts.&lt;/p&gt;
&lt;h3 id=&quot;create-sitecore-indexes-using-all-default-input-parameters&quot;&gt;Create Sitecore indexes using all default input parameters&lt;/h3&gt;
&lt;div class=&quot;language-docker highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker run -d -p 9000:8983 solr create-basic-cores.sh
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Command creates a container from image named &lt;code class=&quot;highlighter-rouge&quot;&gt;solr&lt;/code&gt; for &lt;code class=&quot;highlighter-rouge&quot;&gt;xp&lt;/code&gt; configuration type (i.e. content serach + xdb cores) with prefix &lt;code class=&quot;highlighter-rouge&quot;&gt;sitecore&lt;/code&gt;, using &lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/res/configs/xm/schema.xml&lt;/code&gt; schema file and &lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/res/configs/xm/solrconfig.xml&lt;/code&gt; solrconfig file. It explicitly maps host port &lt;code class=&quot;highlighter-rouge&quot;&gt;9000&lt;/code&gt; to container port &lt;code class=&quot;highlighter-rouge&quot;&gt;8983&lt;/code&gt;.&lt;/p&gt;

&lt;h3 id=&quot;create-sitecore-indexes-for-xm-configuration-only-with-specified-core-prefix-and-specified-schemaxml-file&quot;&gt;Create Sitecore indexes for xm configuration only with specified core prefix and specified schema.xml file&lt;/h3&gt;
&lt;div class=&quot;language-docker highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker run -P -d solr create-basic-cores.sh xm sc82 /opt/res/configs/xm/sc82-schema.xml
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Command creates a container with Solr cores for &lt;code class=&quot;highlighter-rouge&quot;&gt;xm&lt;/code&gt; configuration type only (i.e. content search indexes only) with prefix &lt;code class=&quot;highlighter-rouge&quot;&gt;sc82&lt;/code&gt; (e.g. &lt;code class=&quot;highlighter-rouge&quot;&gt;sc82_core_index&lt;/code&gt;) and each content search index has schema file based on &lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/res/configs/xm/sc82-schema.xml&lt;/code&gt;.&lt;/p&gt;

&lt;h3 id=&quot;create-sitecore-index-for-xp-configuration-only-using-provided-sorl-configuration-path&quot;&gt;Create Sitecore index for xp configuration only using provided Sorl configuration path&lt;/h3&gt;
&lt;div class=&quot;language-docker highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker run -P -d solr create-config-cores.sh xp! sc81 /opt/res/configs/xdb/sc81configs
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Command creates &lt;code class=&quot;highlighter-rouge&quot;&gt;xp&lt;/code&gt; configuartion indexes only using Solr configuration from path &lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/res/configs/xdb/sc81configs&lt;/code&gt;.&lt;/p&gt;

</description>
        <pubDate>Sun, 24 Sep 2017 00:00:00 -0700</pubDate>
        <link>http://localhost:4000/2017-09-24/flexible-solr-container-image-for-sitecore/</link>
        <guid isPermaLink="true">http://localhost:4000/2017-09-24/flexible-solr-container-image-for-sitecore/</guid>
        
        <category>indexing</category>
        
        <category>docker</category>
        
        
        <category>solr</category>
        
        <category>containers</category>
        
      </item>
    
      <item>
        <title>Run Solr + SSL in Docker container with Sitecore indexes</title>
        <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#create-docker-image&quot; id=&quot;markdown-toc-create-docker-image&quot;&gt;Create Docker image&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#docker-image-preparation-considerations&quot; id=&quot;markdown-toc-docker-image-preparation-considerations&quot;&gt;Docker image preparation considerations&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#create-basic-dockerfile&quot; id=&quot;markdown-toc-create-basic-dockerfile&quot;&gt;Create basic Dockerfile&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#generate-ssl-cert&quot; id=&quot;markdown-toc-generate-ssl-cert&quot;&gt;Generate SSL cert&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#set-solr-ssl-parameters&quot; id=&quot;markdown-toc-set-solr-ssl-parameters&quot;&gt;Set Solr SSL parameters&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#copy-local-resources-into-the-docker-image-optional&quot; id=&quot;markdown-toc-copy-local-resources-into-the-docker-image-optional&quot;&gt;&lt;em&gt;Copy local resources into the docker image [OPTIONAL]&lt;/em&gt;&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#pre-create-solr-cores&quot; id=&quot;markdown-toc-pre-create-solr-cores&quot;&gt;Pre-create Solr cores&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#build-docker-image&quot; id=&quot;markdown-toc-build-docker-image&quot;&gt;Build docker image&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#run-docker-container-from-my-image&quot; id=&quot;markdown-toc-run-docker-container-from-my-image&quot;&gt;Run docker container from my image&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#pull-ssl-cert-from-docker-and-install-into-ca-root&quot; id=&quot;markdown-toc-pull-ssl-cert-from-docker-and-install-into-ca-root&quot;&gt;Pull SSL cert from docker and install into CA Root&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#additional-commands-notes-scripts&quot; id=&quot;markdown-toc-additional-commands-notes-scripts&quot;&gt;&lt;em&gt;Additional commands, notes, scripts&lt;/em&gt;&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#list-all-docker-containers&quot; id=&quot;markdown-toc-list-all-docker-containers&quot;&gt;List all Docker containers&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#remove-all-containers-based-on-certain-image&quot; id=&quot;markdown-toc-remove-all-containers-based-on-certain-image&quot;&gt;Remove all containers based on certain image&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The idea here is to run Solr component configured with SSL in its own Docker container that could be used in local development environment.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;TL;TR&lt;br /&gt;
Don’t want to go thru step by step exerciese, then here is &lt;a href=&quot;/resources/media/2017-09-20-run-solr+ssl-in-docker-container-with-sitecore-indexes/Dockerfile&quot;&gt;complete Dockerfile&lt;/a&gt; for this article.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;create-docker-image&quot;&gt;Create Docker image&lt;/h2&gt;
&lt;p&gt;The fastest way to create a Solr docker image is to build it from &lt;a href=&quot;https://hub.docker.com/_/solr/&quot;&gt;already available Solr images&lt;/a&gt;. In this example I use image &lt;a href=&quot;https://github.com/docker-solr/docker-solr/tree/c61a0c9b012c7313c2b5d0d97ddc06693270b734/6.6/alpine&quot;&gt;solr:6.6-alpine&lt;/a&gt;.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;I use Linix based containers for this exercise. Do appropriate switching of Docker engine if you run Docker on Windows.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;docker-image-preparation-considerations&quot;&gt;Docker image preparation considerations&lt;/h3&gt;
&lt;p&gt;Building my own version from an existing image makes sense when I want to change something in the original image or perpahs provide a differnt command or script for an &lt;code class=&quot;highlighter-rouge&quot;&gt;ENTRYPOINT&lt;/code&gt; or &lt;code class=&quot;highlighter-rouge&quot;&gt;CMD&lt;/code&gt;. In this exercise I want to configure Solr with SSL using the image that does not do that. If you just starting with docker images, you may find it tempting to put desired container configuration into shell scripts and then run them via &lt;code class=&quot;highlighter-rouge&quot;&gt;ENTRYPOINT&lt;/code&gt; or &lt;code class=&quot;highlighter-rouge&quot;&gt;CMD&lt;/code&gt; or combination of both. While that’s possible to do, I believe it’s contrary to what containers usually used for. In dev environment containers typically run as stateless components that can be destroyed at any time and re-created with exact same configuration state.&lt;br /&gt;
Having said that there could be situations when you may need to have a statefull container which could be stopped and started many times. In those cases you do need to be carefull what logic you put into &lt;code class=&quot;highlighter-rouge&quot;&gt;ENTRYPOINT&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;CMD&lt;/code&gt; commands as that logic will run &lt;strong&gt;every time&lt;/strong&gt; when you create or start a container.&lt;/p&gt;

&lt;h3 id=&quot;create-basic-dockerfile&quot;&gt;Create basic Dockerfile&lt;/h3&gt;
&lt;p&gt;Create a &lt;code class=&quot;highlighter-rouge&quot;&gt;Dockerfile&lt;/code&gt; in a folder with the following content to make a Solr docker image based on lighweight &lt;a href=&quot;https://hub.docker.com/_/alpine/&quot;&gt;docker alpine linux version&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;language-docker highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; solr:6.6-alpine&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;ENTRYPOINT&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; [&quot;docker-entrypoint.sh&quot;]&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;CMD&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; [&quot;solr-foreground&quot;]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;blockquote&gt;
  &lt;p&gt;Scripts &lt;code class=&quot;highlighter-rouge&quot;&gt;docker-entrypoint.sh&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;solr-foreground&lt;/code&gt; come from original &lt;a href=&quot;https://github.com/docker-solr/docker-solr/tree/8a8e9311fbe5d40861f6d26293441c272a7878f8/6.6&quot;&gt;solr:6.6-alpine&lt;/a&gt; image. For more info on docker &lt;code class=&quot;highlighter-rouge&quot;&gt;ENTRYPOINT&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;CMD&lt;/code&gt; refer to &lt;a href=&quot;https://docs.docker.com/engine/reference/builder/#understand-how-cmd-and-entrypoint-interact&quot;&gt;official docker docs&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Building this &lt;code class=&quot;highlighter-rouge&quot;&gt;Dockerfile&lt;/code&gt; will pull &lt;code class=&quot;highlighter-rouge&quot;&gt;solr:6.6-alpine&lt;/code&gt; image and build it into your local docker repository. So far this configuration doesn’t provide any benefits to me as I just build my local image from already available container. In this case creating a Solr container from my local image would be similar to simply running a docker command:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker run &lt;span class=&quot;nt&quot;&gt;--name&lt;/span&gt; &amp;lt;myContainerName&amp;gt; &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; 8983:8983 solr:6.6-alpine
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h3 id=&quot;generate-ssl-cert&quot;&gt;Generate SSL cert&lt;/h3&gt;
&lt;p&gt;To generate SSL certificate I use &lt;a href=&quot;https://docs.oracle.com/javase/8/docs/technotes/tools/unix/keytool.html&quot;&gt;keytool&lt;/a&gt; that is supplied with Java platform.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;The code below as well as following bits of code will go into the &lt;code class=&quot;highlighter-rouge&quot;&gt;Dockerfile&lt;/code&gt; between lines &lt;code class=&quot;highlighter-rouge&quot;&gt;FROM&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;ENTRYPOINT&lt;/code&gt;.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;div class=&quot;language-docker highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;ENV&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; SOLR_SSL_PATH /opt/solr/server/etc/solr-ssl.keystore.jks&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;ENV&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; SOLR_SSL_PWD secret&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# create SSL certificate&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;RUN &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\
&lt;/span&gt;    &lt;span class=&quot;nv&quot;&gt;$JAVA_HOME&lt;/span&gt;/bin/keytool &lt;span class=&quot;nt&quot;&gt;-genkeypair&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-alias&lt;/span&gt; solr-ssl &lt;span class=&quot;nt&quot;&gt;-keyalg&lt;/span&gt; RSA &lt;span class=&quot;nt&quot;&gt;-keysize&lt;/span&gt; 2048 &lt;span class=&quot;nt&quot;&gt;-keypass&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$SOLR_SSL_PWD&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-storepass&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$SOLR_SSL_PWD&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\
&lt;/span&gt;    &lt;span class=&quot;nt&quot;&gt;-validity&lt;/span&gt; 9999 &lt;span class=&quot;nt&quot;&gt;-keystore&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$SOLR_SSL_PATH&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-ext&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;SAN&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;DNS:localhost,IP:127.0.0.1 &lt;span class=&quot;se&quot;&gt;\
&lt;/span&gt;    &lt;span class=&quot;nt&quot;&gt;-dname&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;CN=localhost, OU=Organizational Unit, O=Organization, L=Location, ST=State, C=Country&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\
&lt;/span&gt;    &lt;span class=&quot;nb&quot;&gt;exit &lt;/span&gt;0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h3 id=&quot;set-solr-ssl-parameters&quot;&gt;Set Solr SSL parameters&lt;/h3&gt;
&lt;p&gt;Next step is to configure Solr SSL parameters with the certificate keystore. For that I need to configure SSL parameters in &lt;code class=&quot;highlighter-rouge&quot;&gt;/solr.in.sh&lt;/code&gt; file.&lt;/p&gt;
&lt;div class=&quot;language-docker highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# set Solr SSL parameters&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;RUN &lt;/span&gt;sed &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;s|#SOLR_SSL_KEY_STORE=.*&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$|&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;SOLR_SSL_KEY_STORE=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$SOLR_SSL_PATH&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;|&quot;&lt;/span&gt; /opt/solr/bin/solr.in.sh &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\
&lt;/span&gt;    sed &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;s/#SOLR_SSL_KEY_STORE_PASSWORD=.*&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$/&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;SOLR_SSL_KEY_STORE_PASSWORD=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$SOLR_SSL_PWD&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/&quot;&lt;/span&gt; /opt/solr/bin/solr.in.sh &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\
&lt;/span&gt;    sed &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'s/#SOLR_SSL_KEY_STORE_TYPE=.*$/SOLR_SSL_KEY_STORE_TYPE=JKS/'&lt;/span&gt; /opt/solr/bin/solr.in.sh &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\
&lt;/span&gt;    sed &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;s|#SOLR_SSL_TRUST_STORE=.*&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$|&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;SOLR_SSL_TRUST_STORE=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$SOLR_SSL_PATH&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;|&quot;&lt;/span&gt; /opt/solr/bin/solr.in.sh &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\
&lt;/span&gt;    sed &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;s/#SOLR_SSL_TRUST_STORE_PASSWORD=.*&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$/&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;SOLR_SSL_TRUST_STORE_PASSWORD=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$SOLR_SSL_PWD&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/&quot;&lt;/span&gt; /opt/solr/bin/solr.in.sh &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\
&lt;/span&gt;    sed &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'s/#SOLR_SSL_TRUST_STORE_TYPE=.*$/SOLR_SSL_TRUST_STORE_TYPE=JKS/'&lt;/span&gt; /opt/solr/bin/solr.in.sh &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\
&lt;/span&gt;    sed &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'s/#SOLR_SSL_NEED_CLIENT_AUTH=.*$/SOLR_SSL_NEED_CLIENT_AUTH=false/'&lt;/span&gt; /opt/solr/bin/solr.in.sh &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\
&lt;/span&gt;    sed &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'s/#SOLR_SSL_WANT_CLIENT_AUTH=.*$/SOLR_SSL_WANT_CLIENT_AUTH=false/'&lt;/span&gt; /opt/solr/bin/solr.in.sh
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;blockquote&gt;
  &lt;p&gt;When a variable contains special characters that are used as a separator for &lt;code class=&quot;highlighter-rouge&quot;&gt;sed&lt;/code&gt; shell command, you must use a different separator character. In this example I use &lt;code class=&quot;highlighter-rouge&quot;&gt;|&lt;/code&gt; separator for commands that use &lt;code class=&quot;highlighter-rouge&quot;&gt;SOLR_SSL_PATH&lt;/code&gt; variable.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;copy-local-resources-into-the-docker-image-optional&quot;&gt;&lt;em&gt;Copy local resources into the docker image [OPTIONAL]&lt;/em&gt;&lt;/h3&gt;
&lt;p&gt;I build my Solr image with certain Solr configuration. For that I’ve configured my &lt;code class=&quot;highlighter-rouge&quot;&gt;solrconfig.xml&lt;/code&gt; in a certain way and prepared my &lt;code class=&quot;highlighter-rouge&quot;&gt;schema.xml&lt;/code&gt; file.&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;For example, I may want to force Solr instance to use &lt;code class=&quot;highlighter-rouge&quot;&gt;schema.xml&lt;/code&gt; file by configuring &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;schemaFactory class=&quot;ClassicIndexSchemaFactory&quot; /&amp;gt;&lt;/code&gt; in &lt;code class=&quot;highlighter-rouge&quot;&gt;solrconfig.xml&lt;/code&gt;). This is necessary for Sitecore 7.x/8.x versions.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;div class=&quot;language-docker highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;COPY&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; res /opt/res&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In this example I’m copying my local &lt;code class=&quot;highlighter-rouge&quot;&gt;res&lt;/code&gt; folder and all of its contents located in the same directory as &lt;code class=&quot;highlighter-rouge&quot;&gt;Dockerfile&lt;/code&gt; onto the &lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/res&lt;/code&gt; path in my docker image. My &lt;code class=&quot;highlighter-rouge&quot;&gt;res&lt;/code&gt; folder structure looks like this:&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;/res
    /configs
        /solrconfig-6.6.0.xml
        /schema-6.6.0.xml
        /managed-schema-6.6.0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h3 id=&quot;pre-create-solr-cores&quot;&gt;Pre-create Solr cores&lt;/h3&gt;
&lt;p&gt;In my case I know upfront what Solr indexes I will need to run my application. Therefore I pre-create all necessary Solr index cores to make them available once Solr instance starts.&lt;/p&gt;
&lt;div class=&quot;language-docker highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;ENV&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; CORE_PREFIX 'myproject'&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;ENV&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; CORES_DIR '/opt/solr/server/solr/mycores'&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;ENV&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; CONFIG_SOURCE '/opt/solr/server/solr/configsets/basic_configs'&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# create CORES_DIR if it doesn't exist&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;RUN if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-z&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$CORES_DIR&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\
&lt;/span&gt;        mkdir &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$CORES_DIR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\
&lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;fi&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;ENV&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; XM_CORE_NAMES &quot;${CORE_PREFIX}_core_index, ${CORE_PREFIX}_master_index, ${CORE_PREFIX}_web_index, ${CORE_PREFIX}_marketingdefinitions_master, ${CORE_PREFIX}_marketingdefinitions_web, ${CORE_PREFIX}_marketing_asset_index_master, ${CORE_PREFIX}_marketing_asset_index_web, ${CORE_PREFIX}_testing_index, ${CORE_PREFIX}_suggested_test_index, ${CORE_PREFIX}_fxm_master_index, ${CORE_PREFIX}_fxm_web_index&quot;&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# create xm index cores&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;RUN &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\
&lt;/span&gt;    &lt;span class=&quot;nv&quot;&gt;ORIG_IFS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;IFS&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\
&lt;/span&gt;    &lt;span class=&quot;nv&quot;&gt;IFS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;', '&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\
&lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;core &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;XM_CORE_NAMES&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\
&lt;/span&gt;        cp &lt;span class=&quot;nt&quot;&gt;-r&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$CONFIG_SOURCE&lt;/span&gt;/ &lt;span class=&quot;nv&quot;&gt;$CORES_DIR&lt;/span&gt;/&lt;span class=&quot;nv&quot;&gt;$core&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\
&lt;/span&gt;        touch &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$CORES_DIR&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$core&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/core.properties&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\
&lt;/span&gt;        &lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;created &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$CORES_DIR&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$core&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\
&lt;/span&gt;        cp /opt/res/configs/xm/schema-6.6.0.xml &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CORES_DIR&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;/&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;core&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;/conf/schema.xml&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\
&lt;/span&gt;        cp /opt/res/configs/xm/solrconfig-6.6.0.xml &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CORES_DIR&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;/&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;core&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;/conf/solrconfig.xml&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\
&lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\
&lt;/span&gt;    &lt;span class=&quot;nv&quot;&gt;IFS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;ORIG_IFS&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\
&lt;/span&gt;    &lt;span class=&quot;nb&quot;&gt;exit &lt;/span&gt;0

&lt;span class=&quot;k&quot;&gt;ENV&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; XP_CORE_NAMES &quot;${CORE_PREFIX}_xdb, ${CORE_PREFIX}_xdb_rebuild&quot;&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# create xp index cores&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;RUN &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\
&lt;/span&gt;    &lt;span class=&quot;nv&quot;&gt;ORIG_IFS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;IFS&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\
&lt;/span&gt;    &lt;span class=&quot;nv&quot;&gt;IFS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;', '&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\
&lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;xcore &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;XP_CORE_NAMES&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\
&lt;/span&gt;        cp &lt;span class=&quot;nt&quot;&gt;-r&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$CONFIG_SOURCE&lt;/span&gt;/ &lt;span class=&quot;nv&quot;&gt;$CORES_DIR&lt;/span&gt;/&lt;span class=&quot;nv&quot;&gt;$xcore&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\
&lt;/span&gt;        touch &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$CORES_DIR&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$xcore&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/core.properties&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\
&lt;/span&gt;        &lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;created &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$CORES_DIR&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$xcore&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\
&lt;/span&gt;        cp /opt/res/configs/xdb/managed-schema-6.6.0 &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CORES_DIR&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;/&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;xcore&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;/conf/managed-schema&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\
&lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\
&lt;/span&gt;    &lt;span class=&quot;nv&quot;&gt;IFS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;ORIG_IFS&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\
&lt;/span&gt;    &lt;span class=&quot;nb&quot;&gt;exit &lt;/span&gt;0

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I use Solr &lt;code class=&quot;highlighter-rouge&quot;&gt;basic_configs&lt;/code&gt; to pre-create my index cores. If a custom set of configs is required, you can put it into the &lt;code class=&quot;highlighter-rouge&quot;&gt;res&lt;/code&gt; folder and then modify the script to use those configs instead.&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;Some of my indexes use &lt;code class=&quot;highlighter-rouge&quot;&gt;schema.xml&lt;/code&gt; and some use &lt;code class=&quot;highlighter-rouge&quot;&gt;managed-schema&lt;/code&gt;. In Solr 6.6.x I don’t have to supply my own &lt;code class=&quot;highlighter-rouge&quot;&gt;solrconfig.xml&lt;/code&gt; for indexes that use &lt;code class=&quot;highlighter-rouge&quot;&gt;managed-schema&lt;/code&gt; as Solr 6.6 uses managed schema by default.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;build-docker-image&quot;&gt;Build docker image&lt;/h3&gt;
&lt;p&gt;Once all &lt;code class=&quot;highlighter-rouge&quot;&gt;Dockerfile&lt;/code&gt; instructions are in place, I need to build my image to add it to my local repository. Image can be build with the following command executed within the directory that contains &lt;code class=&quot;highlighter-rouge&quot;&gt;Dockerfile&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker build &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; my-solr-image &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;blockquote&gt;
  &lt;p&gt;In case you name &lt;code class=&quot;highlighter-rouge&quot;&gt;Dockerfile&lt;/code&gt; something else, you have to supply that file to the &lt;code class=&quot;highlighter-rouge&quot;&gt;docker build&lt;/code&gt; instruction. See &lt;a href=&quot;https://docs.docker.com/engine/reference/commandline/build/#build-with-path&quot;&gt;official docker doc&lt;/a&gt; on this.&lt;/p&gt;
  &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker build &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; my-solr-image &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; /path/to/dockerfile-dev &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;
  &lt;p&gt;All images that you pull or build are added to local repository. To see all images run this command:&lt;/p&gt;
  &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker images
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;
  &lt;h2 id=&quot;run-docker-container-from-my-image&quot;&gt;Run docker container from my image&lt;/h2&gt;
  &lt;p&gt;To create a container from an image, run &lt;code class=&quot;highlighter-rouge&quot;&gt;docker run&lt;/code&gt; command:&lt;/p&gt;
  &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker run &lt;span class=&quot;nt&quot;&gt;--name&lt;/span&gt; my-solr-container &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; 8983:8983 my-solr-image
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;
  &lt;p&gt;This command will create a docker container titled &lt;code class=&quot;highlighter-rouge&quot;&gt;my-solr-container&lt;/code&gt; from image &lt;code class=&quot;highlighter-rouge&quot;&gt;my-solr-image&lt;/code&gt; and will map host port 8983 to docker port 8983. Once container is up and running, I can open my browser and connect to my Solr instance at &lt;code class=&quot;highlighter-rouge&quot;&gt;https://localhost:8983/solr&lt;/code&gt;.
Depending on browser you may need to add exception for SSL certificate when you navigate to Solr instance as your CA may not recognize it.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;pull-ssl-cert-from-docker-and-install-into-ca-root&quot;&gt;Pull SSL cert from docker and install into CA Root&lt;/h2&gt;
&lt;p&gt;Once you get the container up and running, you need to pull cert generated for the container and install into CA Root of your machine to allow HTTPS requests.
You can use &lt;a href=&quot;https://gist.github.com/ivansharamok/552e51305849a9940eac2e5f0326bacf&quot;&gt;import-docker-solrssl-cert.ps1&lt;/a&gt; script to do this.&lt;/p&gt;

&lt;h2 id=&quot;additional-commands-notes-scripts&quot;&gt;&lt;em&gt;Additional commands, notes, scripts&lt;/em&gt;&lt;/h2&gt;
&lt;p&gt;A few additional notes and commands on the subject that I used while working with docker containers.&lt;/p&gt;
&lt;h3 id=&quot;list-all-docker-containers&quot;&gt;List all Docker containers&lt;/h3&gt;
&lt;p&gt;List all running containers&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker ps
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;List all existing containers&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker ps &lt;span class=&quot;nt&quot;&gt;-a&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Get just IDs of all existing containers&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker ps &lt;span class=&quot;nt&quot;&gt;-a&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-q&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h3 id=&quot;remove-all-containers-based-on-certain-image&quot;&gt;Remove all containers based on certain image&lt;/h3&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker ps &lt;span class=&quot;nt&quot;&gt;-a&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-q&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;ancestor&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;my-solr-image | %&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;docker rm &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;blockquote&gt;
  &lt;p&gt;Complete PowerShell script available &lt;a href=&quot;/resources/media/2017-09-20-run-solr+ssl-in-docker-container-with-sitecore-indexes/clean-docker-containers.ps1&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;

</description>
        <pubDate>Wed, 20 Sep 2017 00:00:00 -0700</pubDate>
        <link>http://localhost:4000/2017-09-20/run-solr+ssl-in-docker-container-with-sitecore-indexes/</link>
        <guid isPermaLink="true">http://localhost:4000/2017-09-20/run-solr+ssl-in-docker-container-with-sitecore-indexes/</guid>
        
        <category>indexing</category>
        
        <category>docker</category>
        
        
        <category>solr</category>
        
        <category>containers</category>
        
      </item>
    
      <item>
        <title>Dedicated Sitecore processing instance for reporting database historic rebuild</title>
        <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#configure-processing-instance&quot; id=&quot;markdown-toc-configure-processing-instance&quot;&gt;Configure processing instance&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#configure-connection-string-to-hidden-node&quot; id=&quot;markdown-toc-configure-connection-string-to-hidden-node&quot;&gt;Configure connection string to hidden node&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#configure-aggregation-subsystem-to-use-custom-collectiondata&quot; id=&quot;markdown-toc-configure-aggregation-subsystem-to-use-custom-collectiondata&quot;&gt;Configure aggregation subsystem to use custom collectionData&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#configuration-of-processing-instances&quot; id=&quot;markdown-toc-configuration-of-processing-instances&quot;&gt;Configuration of processing instances&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Here is an idea how you can have a dedicated Sitecore processing instance to run reporting database rebuild or Path Analyzer map rebuild off of a hidden mongodb secondary node.&lt;br /&gt;
Why? - to let primary aggregation/processing instances and mongodb replica set to handle live data and have a separate instance to read historic data from a hidden secondary mongodb node when needed.&lt;/p&gt;

&lt;h1 id=&quot;configure-processing-instance&quot;&gt;Configure processing instance&lt;/h1&gt;

&lt;p&gt;First, you need to configure Sitecore instance as a &lt;a href=&quot;https://doc.sitecore.net/sitecore_experience_platform/82/setting_up_and_maintaining/xdb/configuring_servers/configure_a_processing_server&quot;&gt;processing/aggregation role&lt;/a&gt;.&lt;/p&gt;

&lt;h1 id=&quot;configure-connection-string-to-hidden-node&quot;&gt;Configure connection string to hidden node&lt;/h1&gt;
&lt;p&gt;Add a hidden node to your mongodb replica set.&lt;br /&gt;
For dev and testing purposes you can use &lt;a href=&quot;https://gist.github.com/ivansharamok/93c9bca5a0473e1bb8cef3e15a4efc9d/raw&quot;&gt;CreateMongoReplicaSet-2nod-1arb-1hid.cmd&lt;/a&gt; script to stand up mongodb replica set with a hidden node:&lt;br /&gt;
Then add a connection string to &lt;code class=&quot;highlighter-rouge&quot;&gt;/App_Config/ConnectionStrings.config&lt;/code&gt; pointing to the hidden node. Make sure you add &lt;code class=&quot;highlighter-rouge&quot;&gt;?slaveok=true&lt;/code&gt; to the connection string to allow data provider to read from the hidden node.&lt;/p&gt;
&lt;div class=&quot;language-xml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;connectionStrings&amp;gt;&lt;/span&gt;
  .....
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;add&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;analytics.hidden&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;connectionString=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;mongodb://localhost:27020/sc82_analytics?slaveok=true&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/connectionStrings&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;configure-aggregation-subsystem-to-use-custom-collectiondata&quot;&gt;Configure aggregation subsystem to use custom collectionData&lt;/h1&gt;
&lt;p&gt;Add another &lt;code class=&quot;highlighter-rouge&quot;&gt;collectionData&lt;/code&gt; configuration to &lt;code class=&quot;highlighter-rouge&quot;&gt;aggregation&lt;/code&gt; section and set it to use connection string to hidden mongodb node. Then set aggregation subsystem processes relevant to historic rebuild to use custom &lt;code class=&quot;highlighter-rouge&quot;&gt;collectionData&lt;/code&gt; configuration.&lt;/p&gt;
&lt;div class=&quot;language-xml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;configuration&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;xmlns:patch=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://www.sitecore.net/xmlconfig/&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;xmlns:set=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://www.sitecore.net/xmlconfig/set/&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;sitecore&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;aggregation&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;aggregationContexts&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;interaction&amp;gt;&lt;/span&gt;
          &lt;span class=&quot;nt&quot;&gt;&amp;lt;history&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;nt&quot;&gt;&amp;lt;Source&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;set:ref=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;aggregation/collectionDataHidden&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
          &lt;span class=&quot;nt&quot;&gt;&amp;lt;/history&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;/interaction&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;pathAnalyzer&amp;gt;&lt;/span&gt;
          &lt;span class=&quot;nt&quot;&gt;&amp;lt;history&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;nt&quot;&gt;&amp;lt;Source&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;set:ref=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;aggregation/collectionDataHidden&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
          &lt;span class=&quot;nt&quot;&gt;&amp;lt;/history&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;/pathAnalyzer&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;/aggregationContexts&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- Custom Collection Data for hidden mongodb node --&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;collectionDataHidden&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Sitecore.Analytics.Aggregation.MongoDbCollectionDataProvider, Sitecore.Analytics.MongoDB&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;singleInstance=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;true&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;param&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;desc=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;connectionStringName&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;analytics.hidden&lt;span class=&quot;nt&quot;&gt;&amp;lt;/param&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;/collectionDataHidden&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;historyTaskManager&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;CollectionData&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;set:ref=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;aggregation/collectionDataHidden&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;/historyTaskManager&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;historyWorker&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;CollectionData&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;set:ref=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;aggregation/collectionDataHidden&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;/historyWorker&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/aggregation&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/sitecore&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/configuration&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Download example &lt;a href=&quot;/resources/media/2017-04-30-dedicated-sitecore-processing-instance-for-reportingdb-historic-rebuild/Dedicated.Processing.ReportingDb.Historic.Rebuild.config&quot;&gt;Dedicated.Processing.ReportingDb.Historic.Rebuild.config&lt;/a&gt; patch config file.&lt;/p&gt;

&lt;h1 id=&quot;configuration-of-processing-instances&quot;&gt;Configuration of processing instances&lt;/h1&gt;
&lt;p&gt;Keep in mind that above configuration steps would set you up with Sitecore processing instance that is capable to run reporting database rebuild off of a hidden mongodb node but it does not aggregate live analytical data that is being written to your xDB. Before you run histori rebuild of your reporting database, you need to make sure that primary processing/aggregation instance and dedicated processing/aggregation instance for history rebuilds are configured to point to the same &lt;code class=&quot;highlighter-rouge&quot;&gt;reporting&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;reporting.secondary&lt;/code&gt; databases. In other words these connection strings must be present in all processing/aggregation instances and point to the same databases:&lt;/p&gt;
&lt;div class=&quot;language-xml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;connectionStrings&amp;gt;&lt;/span&gt;
  .....
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;add&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;reporting&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;connectionString=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Data Source=.\SQLEXPRESS;Initial Catalog=sc82_reporting;Integrated Security=False;User ID=sa;Password=example&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;add&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;reporting.secondary&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;connectionString=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Data Source=.\SQLEXPRESS;Initial Catalog=sc82_reporting_secondary;User ID=sa;Password=example&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/connectionStrings&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When reporting database historic rebuild is required, you can start it from dedicated reporting historic rebuild instance and let your primary servers work on live data. When rebuild is finished, &lt;a href=&quot;/resources/media/2017-04-30-dedicated-sitecore-processing-instance-for-reportingdb-historic-rebuild/Dedicated.Processing.ReportingDb.Historic.Rebuild.config&quot;&gt;reconfigure reporting connection strings&lt;/a&gt; on all processing/aggregation instances`.&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;Note&lt;/strong&gt;&lt;br /&gt;
Path Analyzer map rebuild process works with active reporting database. Therefore, you don’t need to reconfigure reporting connection strings after you execute Path Analyzer map rebuild.&lt;/p&gt;
&lt;/blockquote&gt;

</description>
        <pubDate>Thu, 30 Mar 2017 00:00:00 -0700</pubDate>
        <link>http://localhost:4000/2017-03-30/dedicated-sitecore-processing-instance-for-reportingdb-historic-rebuild/</link>
        <guid isPermaLink="true">http://localhost:4000/2017-03-30/dedicated-sitecore-processing-instance-for-reportingdb-historic-rebuild/</guid>
        
        <category>sitecore</category>
        
        <category>xdb</category>
        
        <category>processing</category>
        
        
        <category>experience-analytics</category>
        
      </item>
    
      <item>
        <title>Configure Sitecore indexes for centralized indexing solution</title>
        <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#how-index-relays-to-indexing-strategy&quot; id=&quot;markdown-toc-how-index-relays-to-indexing-strategy&quot;&gt;How index relays to indexing strategy&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#how-eventqueue-plays-a-role&quot; id=&quot;markdown-toc-how-eventqueue-plays-a-role&quot;&gt;How EventQueue plays a role&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#how-to-stop-sending-duplicate-data-to-indexing-solution&quot; id=&quot;markdown-toc-how-to-stop-sending-duplicate-data-to-indexing-solution&quot;&gt;How to stop sending duplicate data to indexing solution&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#dedicated-indexing-instance&quot; id=&quot;markdown-toc-dedicated-indexing-instance&quot;&gt;Dedicated indexing instance&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;That’s a thought on how one should approach configuration of Sitecore indexes when using centralized indexing solution (e.g. Solr or Azure Search).
I use Solr as primary example in this article.&lt;/p&gt;

&lt;h2 id=&quot;how-index-relays-to-indexing-strategy&quot;&gt;How index relays to indexing strategy&lt;/h2&gt;

&lt;p&gt;Each index in Sitecore configuration should have an indexing strategy (defined under &lt;code class=&quot;highlighter-rouge&quot;&gt;/contentSearch/indexConfigurations/indexUpdateStrategies&lt;/code&gt; config section) to define when and how indexing operations happen.&lt;/p&gt;

&lt;p&gt;For example, default &lt;code class=&quot;highlighter-rouge&quot;&gt;sitecore_master_index&lt;/code&gt; uses &lt;code class=&quot;highlighter-rouge&quot;&gt;syncMaster&lt;/code&gt; strategy. It kicks off indexing as soon as any CRUD operation is applied to an item.&lt;/p&gt;
&lt;div class=&quot;language-xml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;        &lt;span class=&quot;nt&quot;&gt;&amp;lt;index&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;sitecore_master_index&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Sitecore.ContentSearch.SolrProvider.SwitchOnRebuildSolrCloudSearchIndex, Sitecore.ContentSearch.SolrProvider&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
          .....
          &lt;span class=&quot;nt&quot;&gt;&amp;lt;strategies&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;hint=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;list:AddStrategy&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;nt&quot;&gt;&amp;lt;strategy&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;ref=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;contentSearch/indexConfigurations/indexUpdateStrategies/syncMaster&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
          &lt;span class=&quot;nt&quot;&gt;&amp;lt;/strategies&amp;gt;&lt;/span&gt;
          .....
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;/index&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;You can imagine that during high number of CRUD operations (e.g. custom job pulls data from external data source), this strategy may overwhelm application server as it will fight for resources to run indexing jobs. 
A way to mitigate this effect is to use &lt;code class=&quot;highlighter-rouge&quot;&gt;intervalAsyncMaster&lt;/code&gt; strategy. It runs per defined period rather than reacts to immediate CRUD operations.&lt;br /&gt;
For second example I’ll use &lt;code class=&quot;highlighter-rouge&quot;&gt;sitecore_web_index&lt;/code&gt; that relies on &lt;code class=&quot;highlighter-rouge&quot;&gt;onPublishEndAsync&lt;/code&gt; strategy. This strategy kicks off indexing operation when &lt;code class=&quot;highlighter-rouge&quot;&gt;PublishEnd&lt;/code&gt; event occurs.&lt;/p&gt;
&lt;div class=&quot;language-xml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;        &lt;span class=&quot;nt&quot;&gt;&amp;lt;index&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;sitecore_web_index&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Sitecore.ContentSearch.SolrProvider.SwitchOnRebuildSolrCloudSearchIndex, Sitecore.ContentSearch.SolrProvider&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
          .....
          &lt;span class=&quot;nt&quot;&gt;&amp;lt;strategies&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;hint=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;list:AddStrategy&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;nt&quot;&gt;&amp;lt;strategy&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;ref=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;contentSearch/indexConfigurations/indexUpdateStrategies/onPublishEndAsync&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
          &lt;span class=&quot;nt&quot;&gt;&amp;lt;/strategies&amp;gt;&lt;/span&gt;
          .....
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;/index&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;how-eventqueue-plays-a-role&quot;&gt;How EventQueue plays a role&lt;/h2&gt;

&lt;p&gt;Now lets imagine that we have distributed Content Management (CM) and Content Delivery (CD) environments. Let’s say there are CM1, CM2 instances and CD1, CD2 instances.&lt;br /&gt;
When content author modifies an item on CM1 instance (i.e. &lt;code class=&quot;highlighter-rouge&quot;&gt;sitecore_master_index&lt;/code&gt; is involved), the item will get indexed according to indexing strategy (giving our example it’s &lt;code class=&quot;highlighter-rouge&quot;&gt;syncMaster&lt;/code&gt; strategy). 
The change will be pushed to the index that is managed by Solr. When the change happens, all other instances get notified via &lt;code class=&quot;highlighter-rouge&quot;&gt;EventQueue&lt;/code&gt; (EQ). Each instance reads EQ entries and replays the events when applicable. 
In this example, CM2 would read the item changed event(s) and replay it locally. This will trigger an indexing operaion on CM2 instance. Since the index is managed by Solr, the indexed data will be sent to Solr. 
However, the same data were already submitted to Solr when the indexing operation happened on CM1 instance.&lt;br /&gt;
The same is true for &lt;code class=&quot;highlighter-rouge&quot;&gt;sitecore_web_index&lt;/code&gt;. When a publishing operation occurs, the index updates will be sent to Solr from each Sitecore instance that has &lt;code class=&quot;highlighter-rouge&quot;&gt;sitecore_web_index&lt;/code&gt; defined.&lt;br /&gt;
As a result Sitecore instances maybe sending the same indexed data multiple times to Solr instance.&lt;/p&gt;

&lt;h2 id=&quot;how-to-stop-sending-duplicate-data-to-indexing-solution&quot;&gt;How to stop sending duplicate data to indexing solution&lt;/h2&gt;

&lt;p&gt;We established that indexing strategy is responsible for triggering indexing operations. The strategy is defined in the configuration of the index. Therefore, one can change it when it’s needed. 
Likely, Sitecore provides several indexing strategies. One of those is &lt;code class=&quot;highlighter-rouge&quot;&gt;manual&lt;/code&gt; strategy. It does not trigger incremental index updates. It can run index update when the index rebuild is called explicitly (e.g. via UI tools).&lt;/p&gt;
&lt;div class=&quot;language-xml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;&amp;lt;!-- AUTOMATIC INDEXING DISABLED STRATEGY 
     Every index that uses this strategy must be manually rebuilt. 
--&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;manual&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Sitecore.ContentSearch.Maintenance.Strategies.ManualStrategy, Sitecore.ContentSearch&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In our example we can set &lt;code class=&quot;highlighter-rouge&quot;&gt;sitecore_master_index&lt;/code&gt; to use &lt;code class=&quot;highlighter-rouge&quot;&gt;manual&lt;/code&gt; strategy on CM2 instance. This will make CM1 the only instance that can push indexed data to Solr.&lt;/p&gt;
&lt;div class=&quot;language-xml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;        &lt;span class=&quot;nt&quot;&gt;&amp;lt;index&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;sitecore_master_index&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Sitecore.ContentSearch.SolrProvider.SwitchOnRebuildSolrCloudSearchIndex, Sitecore.ContentSearch.SolrProvider&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
          .....
          &lt;span class=&quot;nt&quot;&gt;&amp;lt;strategies&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;hint=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;list:AddStrategy&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;nt&quot;&gt;&amp;lt;strategy&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;ref=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;contentSearch/indexConfigurations/indexUpdateStrategies/manual&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
          &lt;span class=&quot;nt&quot;&gt;&amp;lt;/strategies&amp;gt;&lt;/span&gt;
          .....
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;/index&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;For CD instances, we can set &lt;code class=&quot;highlighter-rouge&quot;&gt;sitecore_web_index&lt;/code&gt; to use &lt;code class=&quot;highlighter-rouge&quot;&gt;manual&lt;/code&gt; strategy on CD1, CD2 and CM2 as the same index is already defined on CM1 and uses the same Solr instance.&lt;/p&gt;
&lt;div class=&quot;language-xml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;        &lt;span class=&quot;nt&quot;&gt;&amp;lt;index&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;sitecore_web_index&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Sitecore.ContentSearch.SolrProvider.SwitchOnRebuildSolrCloudSearchIndex, Sitecore.ContentSearch.SolrProvider&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
          .....
          &lt;span class=&quot;nt&quot;&gt;&amp;lt;strategies&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;hint=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;list:AddStrategy&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;nt&quot;&gt;&amp;lt;strategy&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;ref=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;contentSearch/indexConfigurations/indexUpdateStrategies/manual&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
          &lt;span class=&quot;nt&quot;&gt;&amp;lt;/strategies&amp;gt;&lt;/span&gt;
          .....
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;/index&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The downside of such configuration is that your CM environment has 2 instances with different configurations. It would require separate deployment process for CM1 and CM2. One solution could be to use a dedicated indexing instance.&lt;/p&gt;

&lt;h2 id=&quot;dedicated-indexing-instance&quot;&gt;Dedicated indexing instance&lt;/h2&gt;

&lt;p&gt;You can introduce an indexing role that would run all indexing operations for your Sitecore environments. It could be a single instance for all environments or there could be one indexing instance for each environment.
The configuratoin of indexing instance is rather simple. You make sure that all necessary indexes are defined and configured in the indexing instance. 
The same indexes should be set to use &lt;code class=&quot;highlighter-rouge&quot;&gt;manual&lt;/code&gt; strategy for all other Sitecore instances (e.g. CM, CD).&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;It is a common practice to have a job instance that runs application custom jobs. This instance can be an ideal candidate to run all indexing jobs too. 
Though, it all depends on how resource intence your custom jobs are and how often indexing operations happen.&lt;/p&gt;
&lt;/blockquote&gt;
</description>
        <pubDate>Thu, 05 Jan 2017 00:00:00 -0800</pubDate>
        <link>http://localhost:4000/2017-01-05/configure-sitecore-indexes-for-centralized-indexing-solution/</link>
        <guid isPermaLink="true">http://localhost:4000/2017-01-05/configure-sitecore-indexes-for-centralized-indexing-solution/</guid>
        
        <category>sitecore</category>
        
        <category>indexing</category>
        
        
        <category>solr</category>
        
      </item>
    
      <item>
        <title>Configure BasicAuthentication for Solr provider with Sitecore</title>
        <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#configure-solr-basic-authentication-plugin&quot; id=&quot;markdown-toc-configure-solr-basic-authentication-plugin&quot;&gt;Configure Solr basic authentication plugin&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#create-securityjson-file&quot; id=&quot;markdown-toc-create-securityjson-file&quot;&gt;Create /security.json file&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#upload-securityjson-to-zookeeper&quot; id=&quot;markdown-toc-upload-securityjson-to-zookeeper&quot;&gt;Upload /security.json to Zookeeper&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#any-solr-5x-or-6x&quot; id=&quot;markdown-toc-any-solr-5x-or-6x&quot;&gt;Any Solr 5.x or 6.x&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#simplified-command-for-solr-630&quot; id=&quot;markdown-toc-simplified-command-for-solr-630&quot;&gt;Simplified command for Solr 6.3.0&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#configure-sitecore-search-provider-basic-authentication&quot; id=&quot;markdown-toc-configure-sitecore-search-provider-basic-authentication&quot;&gt;Configure Sitecore search provider basic authentication&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
  &lt;p&gt;Approach in this article has been tested with Sitecore 8.2.1 and Solr 6.3.0&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;configure-solr-basic-authentication-plugin&quot;&gt;Configure Solr basic authentication plugin&lt;/h2&gt;

&lt;p&gt;Refer to official &lt;a href=&quot;https://cwiki.apache.org/confluence/display/solr/Basic+Authentication+Plugin&quot;&gt;Basic Authentication Plugin&lt;/a&gt; article to understand how it can be configured.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Note&lt;br /&gt;
Prior to Solr 6.3.0 there is an issue with &lt;code class=&quot;highlighter-rouge&quot;&gt;blockUnknown&lt;/code&gt; property described in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9188&quot;&gt;SOLR-9188&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Steps below provide example configuration of basic authentication plugin for Solr 6.3.0.&lt;/p&gt;

&lt;h3 id=&quot;create-securityjson-file&quot;&gt;Create /security.json file&lt;/h3&gt;

&lt;p&gt;This example configures basic authentication with user &lt;code class=&quot;highlighter-rouge&quot;&gt;solr&lt;/code&gt; and password &lt;code class=&quot;highlighter-rouge&quot;&gt;SolrRocks&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-json highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;authentication&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;blockUnknown&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;class&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;solr.BasicAuthPlugin&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;credentials&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;solr&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;IV0EHq1OnNrj6gvRCwvFwTrZ1+z1oBbnQdiVC3otuq0= Ndd7LKvVBAaZIF0QAVi1ekCfAJXr1GGfLtRUXhgrF8c=&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;authorization&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;class&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;solr.RuleBasedAuthorizationPlugin&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;permissions&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;security-edit&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;role&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;administrator&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;user-role&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;solr&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;administrator&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
  &lt;p&gt;Note&lt;br /&gt;
The &lt;code class=&quot;highlighter-rouge&quot;&gt;authorization&lt;/code&gt; section in the example above does not provide sufficient permissions but rather provided as an example how it can be configured.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;upload-securityjson-to-zookeeper&quot;&gt;Upload /security.json to Zookeeper&lt;/h3&gt;

&lt;p&gt;Execute one of the following commands to upload /security.json file into your Solr instance.&lt;/p&gt;

&lt;h4 id=&quot;any-solr-5x-or-6x&quot;&gt;Any Solr 5.x or 6.x&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&quot;language-bat&quot;&gt;server\scripts\cloud-scripts\zkcli.bat -zkhost localhost:9983 -cmd put /security.json security.json
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&quot;simplified-command-for-solr-630&quot;&gt;Simplified command for Solr 6.3.0&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&quot;language-bat&quot;&gt;bin\solr zk cp file:security.json zk:security.json -z localhost:9983
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;configure-sitecore-search-provider-basic-authentication&quot;&gt;Configure Sitecore search provider basic authentication&lt;/h2&gt;

&lt;p&gt;Solr provider for Sitecore exposes &lt;code class=&quot;highlighter-rouge&quot;&gt;solrHttpWebRequestFactory&lt;/code&gt; configuration section that allows you to configure corresponding C# class that handles Solr request authentication.
To configure Solr provider to use basic authentication patch &lt;code class=&quot;highlighter-rouge&quot;&gt;solrHttpWebRequestFactory&lt;/code&gt; section:&lt;/p&gt;
&lt;div class=&quot;language-xml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  &lt;span class=&quot;nt&quot;&gt;&amp;lt;sitecore&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;contentSearch&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;indexConfigurations&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;solrHttpWebRequestFactory&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;set:type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;HttpWebAdapters.BasicAuthHttpWebRequestFactory, SolrNet&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
          &lt;span class=&quot;nt&quot;&gt;&amp;lt;param&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;hint=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;username&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;solr&lt;span class=&quot;nt&quot;&gt;&amp;lt;/param&amp;gt;&lt;/span&gt;
          &lt;span class=&quot;nt&quot;&gt;&amp;lt;param&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;hint=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;password&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;SolrRocks&lt;span class=&quot;nt&quot;&gt;&amp;lt;/param&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;lt;/solrHttpWebRequestFactory&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;/indexConfigurations&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/contentSearch&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/sitecore&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
  &lt;p&gt;Note&lt;br /&gt;
There is a bug in Solr provider for Sitecore 8.2.1 which does not allow authentication to work properly.
Use &lt;a href=&quot;https://github.com/SitecoreSupport/Sitecore.Support.141324&quot;&gt;Sitecore.Support.141324&lt;/a&gt; patch to work around this issue.&lt;br /&gt;
If you don’t have access to the patch, contact &lt;a href=&quot;https://support.sitecore.net/helpdesk/&quot;&gt;Sitecore Support&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;Note&lt;br /&gt;
There is a bug in Solr provider in version 8.2.1 which does not allow you to create index collection aliases automatically via &lt;code class=&quot;highlighter-rouge&quot;&gt;ContentSearch.Solr.EnforceAliasCreation&lt;/code&gt; setting.
If you want this feature, use patch &lt;a href=&quot;https://github.com/SitecoreSupport/Sitecore.Support.124981&quot;&gt;Sitecore.Support.124981&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;
</description>
        <pubDate>Wed, 04 Jan 2017 00:00:00 -0800</pubDate>
        <link>http://localhost:4000/2017-01-04/configure-basicauth-for-solr-provider/</link>
        <guid isPermaLink="true">http://localhost:4000/2017-01-04/configure-basicauth-for-solr-provider/</guid>
        
        <category>sitecore</category>
        
        <category>indexing</category>
        
        
        <category>solr</category>
        
      </item>
    
      <item>
        <title>MSDeploy Sitecore installation using SolrCloud with SwitchOnRebuild index</title>
        <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#create-custom-sccpl-configurations&quot; id=&quot;markdown-toc-create-custom-sccpl-configurations&quot;&gt;Create custom SCCPL configurations&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#create-config-files-for-sccpl-assembly&quot; id=&quot;markdown-toc-create-config-files-for-sccpl-assembly&quot;&gt;Create config files for SCCPL assembly&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#create-msdeploy-parameters-and-archive-files&quot; id=&quot;markdown-toc-create-msdeploy-parameters-and-archive-files&quot;&gt;Create MSDeploy parameters and archive files&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#create-msdeploy-package&quot; id=&quot;markdown-toc-create-msdeploy-package&quot;&gt;Create MSDeploy package&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#set-msdeploy-parameters&quot; id=&quot;markdown-toc-set-msdeploy-parameters&quot;&gt;Set MSDeploy parameters&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#deploy-sitecore-using-msdeploy-package-and-setparameterxml-file&quot; id=&quot;markdown-toc-deploy-sitecore-using-msdeploy-package-and-setparameterxml-file&quot;&gt;Deploy Sitecore using MSDeploy package and setParameter.xml file&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#copy-licensexml-into-app_data&quot; id=&quot;markdown-toc-copy-licensexml-into-app_data&quot;&gt;Copy license.xml into /App_Data&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
  &lt;p&gt;This article was written using Sitecore 8.2.1&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;This article references resources from &lt;a href=&quot;https://dev.sitecore.net/Downloads/Sitecore_Azure_Toolkit/1x/Sitecore_Azure_Toolkit_100.aspx&quot;&gt;Sitecore Azure Toolkit&lt;/a&gt; to create configuration packages and assemble MSDeploy package.
Refer to blog posts by Bas Lijten to better understand the process of &lt;a href=&quot;http://blog.baslijten.com/sitecore-on-azure-create-custom-web-deploy-packages-using-the-sitecore-azure-toolkit/&quot;&gt;creating custom configuration pacakages (SCCPL)&lt;/a&gt; 
and &lt;a href=&quot;http://blog.baslijten.com/use-the-sitecore-azure-toolkit-to-deploy-your-on-premises-environment/&quot;&gt;MSDeploy package catered to on-prem installation&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&quot;create-custom-sccpl-configurations&quot;&gt;Create custom SCCPL configurations&lt;/h2&gt;

&lt;p&gt;Refer to &lt;a href=&quot;http://blog.baslijten.com/sitecore-on-azure-create-custom-web-deploy-packages-using-the-sitecore-azure-toolkit/&quot;&gt;this article&lt;/a&gt; for more details on how to create custom SCCPL configurations.&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Sitecore.OnPrem.Common.sccpl&lt;/code&gt; configuration&lt;br /&gt;
This configuration adds &lt;code class=&quot;highlighter-rouge&quot;&gt;/App_Data&lt;/code&gt; folder to website root directory and sets Sitecore’s &lt;code class=&quot;highlighter-rouge&quot;&gt;dataFolder&lt;/code&gt; setting to point to it.&lt;br /&gt;
&lt;img src=&quot;/resources/media/2016-12-30-script-sitecore-installation-using-solrcloud-with-switchonrebuild-index/Sitecore-onprem-common-folder-structure.PNG&quot; alt=&quot;common folder structure&quot; /&gt;&lt;br /&gt;
&lt;a href=&quot;/resources/media/2016-12-30-script-sitecore-installation-using-solrcloud-with-switchonrebuild-index/Sitecore.OnPrem.Common.zip&quot;&gt;Download&lt;/a&gt; example configuration structure for this package.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Solr.DataIndexes.Enabled.sccpl&lt;/code&gt; configuration&lt;br /&gt;
This configuration contains instructions to disable config files for Lucene &lt;code class=&quot;highlighter-rouge&quot;&gt;sitecore_core_index&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;sitecore_master_index&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;sitecore_web_index&lt;/code&gt; and enable necessary Solr configs for these indexes.&lt;br /&gt;
&lt;img src=&quot;/resources/media/2016-12-30-script-sitecore-installation-using-solrcloud-with-switchonrebuild-index/solr-dataindexes-enabled-config-structure.PNG&quot; alt=&quot;&quot; /&gt;&lt;br /&gt;
&lt;a href=&quot;/resources/media/2016-12-30-script-sitecore-installation-using-solrcloud-with-switchonrebuild-index/Solr.DataIndexes.Enabled.zip&quot;&gt;Download&lt;/a&gt; example configuration structure for this package.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Solr.DataIndexes.SwitchOnRebuild.Enabled.sccpl&lt;/code&gt; configuration&lt;br /&gt;
This configuration sets Solr SwitchOnRebuild index for data indexes.&lt;br /&gt;
&lt;img src=&quot;/resources/media/2016-12-30-script-sitecore-installation-using-solrcloud-with-switchonrebuild-index/solr-dataindexes-switchonrebuild-enabled-config-structure.PNG&quot; alt=&quot;structure for switchonrebuild enabled config&quot; /&gt;&lt;br /&gt;
&lt;a href=&quot;/resources/media/2016-12-30-script-sitecore-installation-using-solrcloud-with-switchonrebuild-index/Solr.DataIndexes.SwitchOnRebuild.Enabled.zip&quot;&gt;Download&lt;/a&gt; example configuration structure for this package.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;SolrCloud.DataIndexes.Reuse.ScItems.Collection.sccpl&lt;/code&gt; configuration&lt;br /&gt;
This configuration contains patch config files to set reusable Solr collection &lt;code class=&quot;highlighter-rouge&quot;&gt;scitems&lt;/code&gt; for all data indexes.&lt;br /&gt;
&lt;img src=&quot;/resources/media/2016-12-30-script-sitecore-installation-using-solrcloud-with-switchonrebuild-index/solrcloud-dataindexes-reuse-scitems-collection.PNG?raw=true&quot; alt=&quot;reuse scitems collection&quot; /&gt;&lt;br /&gt;
&lt;a href=&quot;/resources/media/2016-12-30-script-sitecore-installation-using-solrcloud-with-switchonrebuild-index/SolrCloud.DataIndexes.Reuse.ScItems.Collection.zip&quot;&gt;Download&lt;/a&gt; example configuration structure for this package.
    &lt;blockquote&gt;
      &lt;p&gt;I use scripts to quickly standup SolrCloud instance with &lt;code class=&quot;highlighter-rouge&quot;&gt;scitems&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;scitems_swap&lt;/code&gt; collections. That’s why I created a separate SCCPL configuration with hard coded collection names.&lt;br /&gt;
Ideally you would set collection names via parameters for your MSDeploy package.&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Sitecore.Security.SetAdminPassword.sccpl&lt;/code&gt; configuration&lt;br /&gt;
This configuration includes SQL script to set custom &lt;code class=&quot;highlighter-rouge&quot;&gt;sitecore\admin&lt;/code&gt; user password when you install MSDeploy package.&lt;br /&gt;
&lt;img src=&quot;/resources/media/2016-12-30-script-sitecore-installation-using-solrcloud-with-switchonrebuild-index/sitecore-security-setadminpassword.PNG?raw=true&quot; alt=&quot;structure for SetSitecoreAdminPassword.sql&quot; /&gt;&lt;br /&gt;
&lt;a href=&quot;/resources/media/2016-12-30-script-sitecore-installation-using-solrcloud-with-switchonrebuild-index/Sitecore.Security.SetAdminPassword.zip&quot;&gt;Download&lt;/a&gt; example configuration structure for this package.
    &lt;blockquote&gt;
      &lt;p&gt;You can get &lt;code class=&quot;highlighter-rouge&quot;&gt;SetSitecoreAdminPassword.sql&lt;/code&gt; file from &lt;code class=&quot;highlighter-rouge&quot;&gt;Sitecore.Cloud.Security.sccpl&lt;/code&gt; package distributed with Sitecore Azure Toolkit.&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;create-config-files-for-sccpl-assembly&quot;&gt;Create config files for SCCPL assembly&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/configs/common.packaging.config.json&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;pre&gt;&lt;code class=&quot;language-JSON&quot;&gt;{
  &quot;sccpls&quot;:[&quot;Sitecore.OnPrem.Common.sccpl&quot;, &quot;Sitecore.Cloud.RoleSpecific_Single.sccpl&quot;, &quot;Sitecore.Security.SetAdminPassword.sccpl&quot;]
}
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
  &lt;p&gt;This configuration assumes that you aim to install Sitecore XP on dev local machine. If you use &lt;code class=&quot;highlighter-rouge&quot;&gt;reporting.apikey&lt;/code&gt; setting in /ConnectionStrings.config file, then remove &lt;code class=&quot;highlighter-rouge&quot;&gt;Sitecore.Cloud.RoleSpecific_Single.sccpl&lt;/code&gt; configuration reference.&lt;br /&gt;
You can find &lt;code class=&quot;highlighter-rouge&quot;&gt;Sitecore.Cloud.RoleSpecific_Single.sccpl&lt;/code&gt; package in resources of Sitecore Azure Toolkit distribution file.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/configs/solrcloud.switchonrebuild.config.json&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;pre&gt;&lt;code class=&quot;language-JSON&quot;&gt;{
  &quot;scwdps&quot;:[
    {
      &quot;role&quot; : &quot;xp-solrcloud&quot;,
      &quot;archiveXml&quot; : &quot;solrcloud.switchonrebuild.archive.xml&quot;,
      &quot;parametersXml&quot;: &quot;solrcloud.switchonrebuild.parameters.xml&quot;,
      &quot;sccpls&quot; : [&quot;Solr.DataIndexes.Enabled.sccpl&quot;, &quot;Solr.DataIndexes.SwitchOnRebuild.Enabled.sccpl&quot;, &quot;SolrCloud.DataIndexes.Reuse.ScItems.Collection.sccpl&quot;]
    }
  ]
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;create-msdeploy-parameters-and-archive-files&quot;&gt;Create MSDeploy parameters and archive files&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/msdeployxmls/solrcloud.switchonrebuild.parameters.xml&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-xml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;parameters&amp;gt;&lt;/span&gt;
  ..........
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;parameter&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Solr Endpoint&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;description=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Sitecore SolrCloud Config&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;tags=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Hidden,NoStore&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;parameterEntry&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;kind=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;XmlFile&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;scope=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;App_Config\\Include\\.ContentSearch\.Solr\.DefaultIndexConfiguration\.config$&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;match=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;//settings/setting[@name='ContentSearch.Solr.ServiceBaseAddress']/@value&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/parameter&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/parameters&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;a href=&quot;/resources/media/2016-12-30-script-sitecore-installation-using-solrcloud-with-switchonrebuild-index/solrcloud.switchonrebuild.parameters.xml&quot;&gt;Download&lt;/a&gt; complete example parameters.xml file.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/msdeployxmls/solrcloud.switchonrebuild.archive.xml&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-xml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;sitemanifest&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;MSDeploy.ObjectResolver.createApp=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Microsoft.Web.Deployment.CreateApplicationObjectResolver&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;MSDeploy.ObjectResolver.dirPath=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Microsoft.Web.Deployment.DirPathObjectResolver&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;MSDeploy.ObjectResolver.filePath=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Microsoft.Web.Deployment.FilePathObjectResolver&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;dbDacFx&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;path=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Sitecore.Reporting.dacpac&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;databaseName=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Sitecore.Reporting.dacpac&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;MSDeploy.databaseName=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;1&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;MSDeploy.MSDeployLinkName=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Child2&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;MSDeploy.MSDeployKeyAttributeName=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;path&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;MSDeploy.MSDeployProviderOptions=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;...&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;MSDeploy.MSDeployObjectFlags=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;1&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;MSDeploy.MSDeployStreamRelativeFilePath=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Sitecore.Reporting.dacpac&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;dbDacFx&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;path=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Sitecore.Core.dacpac&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;databaseName=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Sitecore.Core.dacpac&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;MSDeploy.databaseName=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;1&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;MSDeploy.MSDeployLinkName=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Child3&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;MSDeploy.MSDeployKeyAttributeName=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;path&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;MSDeploy.MSDeployProviderOptions=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;...&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;MSDeploy.MSDeployObjectFlags=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;1&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;MSDeploy.MSDeployStreamRelativeFilePath=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Sitecore.Core.dacpac&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;dbDacFx&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;path=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Sitecore.Master.dacpac&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;databaseName=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Sitecore.Master.dacpac&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;MSDeploy.databaseName=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;1&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;MSDeploy.MSDeployLinkName=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Child4&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;MSDeploy.MSDeployKeyAttributeName=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;path&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;MSDeploy.MSDeployProviderOptions=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;...&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;MSDeploy.MSDeployObjectFlags=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;1&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;MSDeploy.MSDeployStreamRelativeFilePath=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Sitecore.Master.dacpac&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;dbDacFx&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;path=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Sitecore.Web.dacpac&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;databaseName=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Sitecore.Web.dacpac&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;MSDeploy.databaseName=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;1&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;MSDeploy.MSDeployLinkName=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Child5&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;MSDeploy.MSDeployKeyAttributeName=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;path&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;MSDeploy.MSDeployProviderOptions=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;...&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;MSDeploy.MSDeployObjectFlags=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;1&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;MSDeploy.MSDeployStreamRelativeFilePath=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Sitecore.Web.dacpac&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;dbFullSql&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;path=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;SetSitecoreAdminPassword.sql&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;MSDeploy.MSDeployLinkName=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Child10&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;MSDeploy.MSDeployKeyAttributeName=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;path&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;MSDeploy.MSDeployProviderOptions=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;...&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    .....
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/dbFullSql&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;iisApp&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;path=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Website&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;MSDeploy.path=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;2&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;MSDeploy.MSDeployLinkName=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Child1&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;MSDeploy.MSDeployKeyAttributeName=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;path&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;MSDeploy.MSDeployProviderOptions=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;...&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
  .....
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/iisApp&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/sitemanifest&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;a href=&quot;/resources/media/2016-12-30-script-sitecore-installation-using-solrcloud-with-switchonrebuild-index/solrcloud.switchonrebuild.archive.xml&quot;&gt;Download&lt;/a&gt; complete example archive.xml file.&lt;/p&gt;

&lt;h2 id=&quot;create-msdeploy-package&quot;&gt;Create MSDeploy package&lt;/h2&gt;

&lt;p&gt;Assemble MSDeploy package:&lt;/p&gt;
&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;Start&lt;/span&gt;-SitecoreAzurePackaging -sitecorePath &lt;span class=&quot;s1&quot;&gt;'C:\simRepo\Sitecore 8.2 rev. 161115.zip'&lt;/span&gt; -destinationFolderPath &lt;span class=&quot;s1&quot;&gt;'C:\wdps'&lt;/span&gt; -cargoPayloadFolderPath &lt;span class=&quot;s1&quot;&gt;'.\customDeploy\cpls'&lt;/span&gt; -commonConfigPath &lt;span class=&quot;s1&quot;&gt;'.\customDeploy\configs\common.packaging.config.json'&lt;/span&gt; -skuConfigPath &lt;span class=&quot;s1&quot;&gt;'.\customDeploy\configs\solrcloud.switchonrebuild.config.json'&lt;/span&gt; -archiveAndParameterXmlPath &lt;span class=&quot;s1&quot;&gt;'.\customDeploy\msdeployxmls'&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;set-msdeploy-parameters&quot;&gt;Set MSDeploy parameters&lt;/h2&gt;

&lt;p&gt;Create setParameter.xml file where you specify MSDeploy parameters values:&lt;/p&gt;
&lt;div class=&quot;language-xml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;parameters&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;setParameter&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Application Path&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;value=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;tst821&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;setParameter&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Sitecore Admin New Password&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;value=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;b&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;setParameter&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Core Admin Connection String&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;value=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Data Source=.\SQLEXPRESS;Initial Catalog=tst821_core;Integrated Security=False;User ID=sa;Password=12345&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;setParameter&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Core Connection String&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;value=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Data Source=.\SQLEXPRESS;Initial Catalog=tst821_core;Integrated Security=False;User ID=sa;Password=12345&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;setParameter&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Master Admin Connection String&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;value=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Data Source=.\SQLEXPRESS;Initial Catalog=tst821_master;Integrated Security=False;User ID=sa;Password=12345&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;setParameter&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Master Connection String&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;value=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Data Source=.\SQLEXPRESS;Initial Catalog=tst821_master;Integrated Security=False;User ID=sa;Password=12345&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;setParameter&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Web Admin Connection String&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;value=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Data Source=.\SQLEXPRESS;Initial Catalog=tst821_web;Integrated Security=False;User ID=sa;Password=12345&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;setParameter&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Web Connection String&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;value=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Data Source=.\SQLEXPRESS;Initial Catalog=tst821_web;Integrated Security=False;User ID=sa;Password=12345&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;setParameter&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Reporting Admin Connection String&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;value=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Data Source=.\SQLEXPRESS;Initial Catalog=tst821_reporting;Integrated Security=False;User ID=sa;Password=12345&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;setParameter&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Reporting Connection String&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;value=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Data Source=.\SQLEXPRESS;Initial Catalog=tst821_reporting;Integrated Security=False;User ID=sa;Password=12345&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;setParameter&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Analytics Connection String&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;value=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;mongodb://localhost:27017/tst821_analytics&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;setParameter&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Tracking Live Connection String&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;value=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;mongodb://localhost:27017/tst821_tracking_live&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;setParameter&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Tracking History Connection String&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;value=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;mongodb://localhost:27017/tst821_tracking_history&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;setParameter&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Tracking Contact Connection String&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;value=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;mongodb://localhost:27017/tst821_tracking_contact&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;setParameter&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Build Number&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;value=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;5&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;setParameter&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Solr Endpoint&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;value=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://localhost:8983/solr&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/parameters&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;deploy-sitecore-using-msdeploy-package-and-setparameterxml-file&quot;&gt;Deploy Sitecore using MSDeploy package and setParameter.xml file&lt;/h2&gt;

&lt;blockquote&gt;
  &lt;p&gt;Command below assumes that &lt;code class=&quot;highlighter-rouge&quot;&gt;msdeploy&lt;/code&gt; path is added to &lt;code class=&quot;highlighter-rouge&quot;&gt;Path&lt;/code&gt; environment variable.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;msdeploy -presync:runCommand&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;%SYSTEMROOT%\System32\inetsrv\appcmd add apppool /name:tst821 &amp;amp; %SYSTEMROOT%\System32\inetsrv\appcmd add site /name:tst821 /bindings:http://tst821.local:80 /physicalPath:C:\inetpub\wwwroot\tst821\Website &amp;amp; %SYSTEMROOT%\System32\inetsrv\appcmd set app tst821/ /applicationPool:tst821&quot;&lt;/span&gt; -source:package&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;C:\wdps\Sitecore 8.2 rev. 161115_xp-solrcloud.scwdp.zip&quot;&lt;/span&gt; -dest:auto,IncludeAcls&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'False'&lt;/span&gt; -verb:sync -disableLink:ContentExtension -disableLink:AppPoolExtension -disableLink:CertificateExtension -retryAttempts:2 -setParamFile:&lt;span class=&quot;s2&quot;&gt;&quot;customDeploy\solrcloud.msdeploy.setParameters.xml&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;copy-licensexml-into-app_data&quot;&gt;Copy license.xml into /App_Data&lt;/h2&gt;

&lt;p&gt;Last thing to do is to copy your &lt;code class=&quot;highlighter-rouge&quot;&gt;license.xml&lt;/code&gt; file into &lt;code class=&quot;highlighter-rouge&quot;&gt;/App_Data&lt;/code&gt; folder and you should be good to go.&lt;br /&gt;
Keep in mind that this example shows how to configure only 3 data indexes with Solr using SwitchOnRebuild index. If you want to switch all indexes to Solr, add necessary configurations to disable Lucene configs for those indexes and enable corresponding Solr configs.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Note&lt;br /&gt;
There is a bug in Solr provider in version 8.2.1 which does not allow you to create index collection aliases automatically via &lt;code class=&quot;highlighter-rouge&quot;&gt;ContentSearch.Solr.EnforceAliasCreation&lt;/code&gt; setting.
If you want this feature, use patch &lt;a href=&quot;https://github.com/SitecoreSupport/Sitecore.Support.124981&quot;&gt;Sitecore.Support.124981&lt;/a&gt;.&lt;br /&gt;
If you don’t have access to the repo, contact &lt;a href=&quot;https://support.sitecore.net/helpdesk/&quot;&gt;Sitecore Support&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;

</description>
        <pubDate>Fri, 30 Dec 2016 00:00:00 -0800</pubDate>
        <link>http://localhost:4000/2016-12-30/script-sitecore-installation-using-solrcloud-with-switchonrebuild-index/</link>
        <guid isPermaLink="true">http://localhost:4000/2016-12-30/script-sitecore-installation-using-solrcloud-with-switchonrebuild-index/</guid>
        
        <category>sitecore</category>
        
        <category>msdeploy</category>
        
        <category>indexing</category>
        
        
        <category>solr</category>
        
        <category>installation</category>
        
      </item>
    
      <item>
        <title>Customize Sitecore Azure toolkit deployment</title>
        <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#expanded-view-of-sat-resources&quot; id=&quot;markdown-toc-expanded-view-of-sat-resources&quot;&gt;Expanded view of SAT resources&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#cargo-payloads-sccpl-packages&quot; id=&quot;markdown-toc-cargo-payloads-sccpl-packages&quot;&gt;Cargo payloads (SCCPL) packages&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#wdp-mapping-configuration-files&quot; id=&quot;markdown-toc-wdp-mapping-configuration-files&quot;&gt;WDP mapping configuration files&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#msdeploy-configs&quot; id=&quot;markdown-toc-msdeploy-configs&quot;&gt;MSDeploy configs&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#automate-packaging-process&quot; id=&quot;markdown-toc-automate-packaging-process&quot;&gt;Automate packaging process&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#upload-wdp-into-azure-blob&quot; id=&quot;markdown-toc-upload-wdp-into-azure-blob&quot;&gt;Upload WDP into Azure Blob&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#deploy-sitecore-on-azure&quot; id=&quot;markdown-toc-deploy-sitecore-on-azure&quot;&gt;Deploy Sitecore on Azure&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Get familiar with &lt;a href=&quot;https://doc.sitecore.net/cloud/working_with_sitecore_azure_toolkit/packaging/packaging_a_sitecore_solution_for_the_microsoft_azure_app_service&quot;&gt;packaging approach for Sitecore on Azure&lt;/a&gt; (SoA) to understand the basics of packaging SoA solution.
Also check out &lt;a href=&quot;https://doc.sitecore.net/cloud/working_with_sitecore_azure_toolkit/overview/getting_started_with_sitecore_azure_toolkit&quot;&gt;Getting started with Sitecore Azure Toolkit&lt;/a&gt; to understand configuration peices of packaing process.&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;&lt;a href=&quot;https://dev.sitecore.net/Downloads/Sitecore_Azure_Toolkit/1x/Sitecore_Azure_Toolkit_100.aspx&quot;&gt;Sitecore Azure Toolkit&lt;/a&gt; may also be referred to as Sitecore Azure SDK or Provisioning SDK.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;This article explains what you need to do to create a custom configuration of SoA Web Deployment Package (WDP). Described configuration below is catered to example ARM templates 
&lt;a href=&quot;https://github.com/ivansharamok/Sitecore-Azure-Quickstart-Templates/tree/master/Sitecore%208.2.1/am0&quot;&gt;AM0&lt;/a&gt;, 
&lt;a href=&quot;https://github.com/ivansharamok/Sitecore-Azure-Quickstart-Templates/tree/master/Sitecore%208.2.1/am&quot;&gt;AM&lt;/a&gt;, 
&lt;a href=&quot;https://github.com/ivansharamok/Sitecore-Azure-Quickstart-Templates/tree/master/Sitecore%208.2.1/ams&quot;&gt;AMS&lt;/a&gt;.&lt;br /&gt;
Unlike &lt;a href=&quot;https://github.com/ivansharamok/Sitecore-Azure-Quickstart-Templates/tree/master/Sitecore%208.2.1/xm&quot;&gt;XM&lt;/a&gt; deployment type, AM type is created to deploy Sitecore app and connect it to already existing resources.&lt;/p&gt;

&lt;h2 id=&quot;expanded-view-of-sat-resources&quot;&gt;Expanded view of SAT resources&lt;/h2&gt;

&lt;p&gt;This is to add to what’s mentioned in &lt;a href=&quot;https://doc.sitecore.net/cloud/working_with_sitecore_azure_toolkit/overview/getting_started_with_sitecore_azure_toolkit&quot;&gt;offical doc article&lt;/a&gt; and SAT README file.&lt;/p&gt;

&lt;h3 id=&quot;cargo-payloads-sccpl-packages&quot;&gt;Cargo payloads (SCCPL) packages&lt;/h3&gt;

&lt;p&gt;SCCPL packages located at /cargopayloads folder in Sitecore Azure Toolkit (SAT) distributive. They hold configurations that can be applied to WDP during the packaging time. There are common SCCPL as well as role specific ones. 
For example, &lt;code class=&quot;highlighter-rouge&quot;&gt;Sitecore.Cloud.Security.sccpl&lt;/code&gt; contains SQL scripts that get executed to configure Sitecore databases (i.e. set up database users, configure Sitecore admin user password) during deployment.&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;For more details on how to create custom SCCPL packages check out &lt;a href=&quot;http://blog.baslijten.com/sitecore-on-azure-create-custom-web-deploy-packages-using-the-sitecore-azure-toolkit/&quot;&gt;Bas Lijten’s blog post&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;wdp-mapping-configuration-files&quot;&gt;WDP mapping configuration files&lt;/h3&gt;

&lt;p&gt;You can find config mapping files in the /configs folder of SAT. These types of configs describe resources that WDP will include after packaging. Configs use &lt;code class=&quot;highlighter-rouge&quot;&gt;JSON&lt;/code&gt; format. 
There are two types of configs: &lt;code class=&quot;highlighter-rouge&quot;&gt;common&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;role specific&lt;/code&gt;.&lt;br /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;Common&lt;/code&gt; config lists SCCPL packages that will be applied to each WDP. Here is an example of &lt;code class=&quot;highlighter-rouge&quot;&gt;common&lt;/code&gt; config for AM type ARM templates:&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;{
    &quot;sccpls&quot;:[&quot;Sitecore.Cloud.Common.sccpl&quot;, &quot;Sitecore.Cloud.Search.sccpl&quot;, &quot;Sitecore.Cloud.ApplicationInsights.sccpl&quot;, &quot;Sitecore.Cloud.Thundercracker.sccpl&quot;]
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Where as the other type describes &lt;code class=&quot;highlighter-rouge&quot;&gt;role specific&lt;/code&gt; configurations. Here is example of &lt;code class=&quot;highlighter-rouge&quot;&gt;role specifc&lt;/code&gt; config for AM type ARM templates:&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;{
    &quot;scwdps&quot;:[
        {
            &quot;role&quot; : &quot;appcd&quot;,
            &quot;archiveXml&quot; : &quot;aM.App.archive.xml&quot;,
            &quot;parametersXml&quot;: &quot;aM.CD.parameters.xml&quot;,
            &quot;sccpls&quot; : [&quot;Sitecore.Cloud.RoleSpecific_CD.sccpl&quot;, &quot;Sitecore.Cloud.Redis_CD.sccpl&quot;, &quot;Sitecore.Cloud.DisableAnalytics.sccpl&quot;, &quot;Sitecore.Cloud.Thundercracker_CD.sccpl&quot;, &quot;Sitecore.Cloud.Security_CD.sccpl&quot;]
        },
        {
            &quot;role&quot; : &quot;appcm&quot;,
            &quot;archiveXml&quot; : &quot;aM.App.archive.xml&quot;,
            &quot;parametersXml&quot;: &quot;aM.CM.parameters.xml&quot;,
            &quot;sccpls&quot; : [&quot;Sitecore.Cloud.RoleSpecific_CM.sccpl&quot;, &quot;Sitecore.Cloud.DisableAnalytics.sccpl&quot;, &quot;Sitecore.Cloud.HttpsRedirection.sccpl&quot;, &quot;Sitecore.Cloud.IPSecurity.sccpl&quot;]
        }
    ]
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Example:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;The &lt;a href=&quot;/resources/media/2016-12-10-customize-sitecore-azuretoolkit-deployment/configs/common.app.packaging.config.json&quot;&gt;common.app.packaging.config.json&lt;/a&gt; file represents common configuration for deployment type that does not create and configure Sitecore databases.&lt;/li&gt;
  &lt;li&gt;The &lt;a href=&quot;/resources/media/2016-12-10-customize-sitecore-azuretoolkit-deployment/configs/am.packaging.config.json&quot;&gt;am.packaging.config.json&lt;/a&gt; file represents configuration for AM type deployment.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;You can see more examples at &lt;a href=&quot;https://github.com/ivansharamok/Sitecore-Azure-Quickstart-Templates/tree/master/Sitecore%208.2.1&quot;&gt;sitecore-on-azure/configs&lt;/a&gt; folder.&lt;/p&gt;

&lt;h3 id=&quot;msdeploy-configs&quot;&gt;MSDeploy configs&lt;/h3&gt;

&lt;p&gt;These &lt;code class=&quot;highlighter-rouge&quot;&gt;XML&lt;/code&gt; files represent &lt;code class=&quot;highlighter-rouge&quot;&gt;MSDeploy manifest&lt;/code&gt; (archive.xml) and &lt;code class=&quot;highlighter-rouge&quot;&gt;MSDeploy parameters&lt;/code&gt; (parameters.xml) configurations. The &lt;code class=&quot;highlighter-rouge&quot;&gt;archive.xml&lt;/code&gt; contains descriptions of SQL databases, SQL scripts and IIS application. Whereas &lt;code class=&quot;highlighter-rouge&quot;&gt;parameters.xml&lt;/code&gt; has list of parameters that can be used to configure your application during the deployment process. For instance, set database connection strings or use &lt;code class=&quot;highlighter-rouge&quot;&gt;sitecore admin password&lt;/code&gt; variable to set sitecore admin user password etc.&lt;/p&gt;

&lt;p&gt;Example:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;The &lt;a href=&quot;/resources/media/2016-12-10-customize-sitecore-azuretoolkit-deployment/msdeployxmls/aM.App.archive.xml&quot;&gt;aM.App.archive.xml&lt;/a&gt; file describes MSDeploy manifest for AM type deployment.&lt;/li&gt;
  &lt;li&gt;The &lt;a href=&quot;/resources/media/2016-12-10-customize-sitecore-azuretoolkit-deployment/msdeployxmls/aM.CM.parameters.xml&quot;&gt;aM.CM.parameters.xml&lt;/a&gt; file describes MSDeploy parameters for &lt;code class=&quot;highlighter-rouge&quot;&gt;CM&lt;/code&gt; role of AM type deployment.&lt;/li&gt;
  &lt;li&gt;The &lt;a href=&quot;/resources/media/2016-12-10-customize-sitecore-azuretoolkit-deployment/msdeployxmls/aM.CD.parameters.xml&quot;&gt;aM.CD.parameters.xml&lt;/a&gt; file describes MSDeploy parameters for &lt;code class=&quot;highlighter-rouge&quot;&gt;CD&lt;/code&gt; role of AM type deployment.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;You can see more MSDeploy configuration examples at &lt;a href=&quot;https://github.com/ivansharamok/Sitecore-Azure-Quickstart-Templates/tree/master/Sitecore%208.2.1&quot;&gt;sitecore-on-azure/msdeployxmls&lt;/a&gt; folder.&lt;/p&gt;

&lt;h2 id=&quot;automate-packaging-process&quot;&gt;Automate packaging process&lt;/h2&gt;

&lt;p&gt;Here is example PS code that can be used to assemble SoA WDP for AM deployment:&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Start-SitecoreAzurePackaging -sitecorePath '.\Sitecore 8.2 rev. 161115_nodb.zip' `
                             -destinationFolderPath .\aM `
                             -cargoPayloadFolderPath .\resources\8.2.1\cargopayloads `
                             -archiveAndParameterXmlPath .\resources\8.2.1\msdeployxmls `
                             -commonConfigPath .\resources\8.2.1\configs\common.app.packaging.config.json `
                             -skuConfigPath .\resources\8.2.1\configs\aM0.packaging.config.json
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;blockquote&gt;
  &lt;p&gt;Note that example above uses &lt;code class=&quot;highlighter-rouge&quot;&gt;_nodb.zip&lt;/code&gt; which has databases stripped out of Sitecore distributive as they are not necessary for AM deployment type.&lt;br /&gt;
Tha’s why &lt;a href=&quot;/resources/media/2016-12-10-customize-sitecore-azuretoolkit-deployment/configs/common.app.packaging.config.json&quot;&gt;common.app.packaging.config.json&lt;/a&gt; config has &lt;code class=&quot;highlighter-rouge&quot;&gt;Sitecore.Cloud.Security.sccpl&lt;/code&gt; reference removed comparing to default configuration in &lt;code class=&quot;highlighter-rouge&quot;&gt;common.packaging.config.json&lt;/code&gt; file.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;You can use &lt;a href=&quot;/resources/media/2016-12-10-customize-sitecore-azuretoolkit-deployment/ps/packageSoA.ps1&quot;&gt;packageSoA.ps1&lt;/a&gt; script as an example.&lt;/p&gt;

&lt;h2 id=&quot;upload-wdp-into-azure-blob&quot;&gt;Upload WDP into Azure Blob&lt;/h2&gt;

&lt;p&gt;Once WDPs are ready, you need to make them available over HTTP for deployment MSDeploy process. I used &lt;a href=&quot;http://aka.ms/downloadazcopy&quot;&gt;AzCopy&lt;/a&gt; tool to upload them into my Azure Blob storage account.&lt;br /&gt;
You can use &lt;a href=&quot;/resources/media/2016-12-10-customize-sitecore-azuretoolkit-deployment/ps/uploadSoAWdp2AzBlob.ps1&quot;&gt;uploadSoAWdp2AzBlob.ps1&lt;/a&gt; example script to upload WDPs int your Azure Blob. 
The script creates &lt;code class=&quot;highlighter-rouge&quot;&gt;resourcelist.json&lt;/code&gt; file with links to uploaded resources.&lt;/p&gt;

&lt;h2 id=&quot;deploy-sitecore-on-azure&quot;&gt;Deploy Sitecore on Azure&lt;/h2&gt;

&lt;p&gt;To deploy SoA using desired ARM templates, follow instctions described at &lt;a href=&quot;https://github.com/Sitecore/Sitecore-Azure-Quickstart-Templates&quot;&gt;Sitecore Azure Quickstart Templates&lt;/a&gt; project.&lt;/p&gt;

</description>
        <pubDate>Sat, 10 Dec 2016 00:00:00 -0800</pubDate>
        <link>http://localhost:4000/2016-12-10/customize-sitecore-azuretoolkit-deployment/</link>
        <guid isPermaLink="true">http://localhost:4000/2016-12-10/customize-sitecore-azuretoolkit-deployment/</guid>
        
        <category>sitecore</category>
        
        <category>deployment</category>
        
        
        <category>azure</category>
        
      </item>
    
  </channel>
</rss>
