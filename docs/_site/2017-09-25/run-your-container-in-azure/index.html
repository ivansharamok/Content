<!DOCTYPE html>
<html>

<head>
    <title>Run your container in Azure</title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="keywords" content="Run your container in Azure, solr,containers,azure, indexing,docker, Works on my machine" />
    <meta name="description" content="Run your container in Azure, solr,containers,azure, indexing,docker, " />
    <meta name="theme-color" content="#2CA6CB"/>
    <link rel="shortcut icon" type="image/x-icon" media="screen" href="http://localhost:4000/favicon.ico" />
    <link rel="canonical" href="http://localhost:4000/2017-09-25/run-your-container-in-azure/" />
    <link rel="alternate" type="application/rss+xml" title="Works on my machine" href="/feed.xml"  />

    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.0/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="https://cdn.bootcss.com/octicons/3.5.0/octicons.min.css" >
    <!-- <link rel="stylesheet" type="text/css" href="http://localhost:4000/static/css/style.css" /> -->
    <link rel="stylesheet" type="text/css" href="http://localhost:4000/static/css/style.css" />
    <link rel="stylesheet" type="text/css" href="http://localhost:4000/static/css/highlight.css" />
    <link rel="stylesheet" type="text/css" href="http://localhost:4000/static/css/post.css" />
    
    <!-- Hide resource from search bots for now -->
    <meta name="robots" content="noindex,nofollow">
</head>


<body>

    <header>
        <nav class="navbar navbar-tiffany rectangle" role="navigation">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="http://localhost:4000/">Works on my machine</a>
                    <p class="navbar-text">Notes, thoughts, experiments</p>
                </div>
                <div class="collapse navbar-collapse">
                    <ul class="nav navbar-nav navbar-right">
                        
                        <li>
                        <a href="http://localhost:4000/" class="word-keep"><span class="octicon octicon-book"></span></span>&nbsp;&nbsp;Blog</a>
                        </li>
                        
                        
                        <li>
                            <a href="http://localhost:4000/archive/" class="word-keep"><span class="octicon octicon-repo"></span>&nbsp;&nbsp;Archive</a>
                        </li>
                        
                        
                        
                        
                        <li>
                            <a href="http://localhost:4000/category/" class="word-keep"><span class="octicon octicon-list-unordered"></span>&nbsp;&nbsp;Category</a>
                        </li>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <li><a href="#stq=" class="search-button"><span class="octicon octicon-search"></span></a></li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>



<div class="main">
    <div class="container">
        <div class="row">
    <div class="content col-lg-9">
        <div class="sheet post">
          <header>
            <h2>Run your container in Azure</h2>
            <p class="post-meta">
                <span class="octicon octicon-clock"></span> Sep 25, 2017
            </p>
            <p class="post-tag">
                <span><a href="http://localhost:4000/category/#solr"><span class="octicon octicon-list-unordered"></span>&nbsp;solr</a><a href="http://localhost:4000/category/#containers"><span class="octicon octicon-list-unordered"></span>&nbsp;containers</a><a href="http://localhost:4000/category/#azure"><span class="octicon octicon-list-unordered"></span>&nbsp;azure</a></span>
                <span>
                    <a class="word-keep" href="http://localhost:4000/tags/#indexing"><span class="octicon octicon-tag"></span>&nbsp;indexing</a>
                    
                    <a class="word-keep" href="http://localhost:4000/tags/#docker"><span class="octicon octicon-tag"></span>&nbsp;docker</a>
                    
                </span>
            </p>
          </header>
          <hr class="boundary">
          <article>
            <ul id="markdown-toc">
  <li><a href="#create-azure-container-registry" id="markdown-toc-create-azure-container-registry">Create Azure Container Registry</a></li>
  <li><a href="#tag-image-to-be-pushed-into-acr" id="markdown-toc-tag-image-to-be-pushed-into-acr">Tag image to be pushed into ACR</a></li>
  <li><a href="#push-image-into-acr" id="markdown-toc-push-image-into-acr">Push image into ACR</a></li>
  <li><a href="#create-azure-container-instance-from-acr-image" id="markdown-toc-create-azure-container-instance-from-acr-image">Create Azure Container Instance from ACR image</a></li>
</ul>

<p>I can run <a href="/2017-09-20/run-solr+ssl-in-docker-container-with-sitecore-indexes/">Solr+SSL docker container</a> and a bit more <a href="/2017-09-24/flexible-solr-container-image-for-sitecore/">flexible Solr+SSL container</a> with Sitecore indexes on my local machine. In this exercise I push my local Docker image into <a href="https://azure.microsoft.com/en-us/services/container-registry/">Azure Container Registry</a> (ACR) and then create <a href="https://azure.microsoft.com/en-us/services/container-instances/">Azure Container Instance</a> (ACI) to run my container in Azure.</p>

<blockquote>
  <p>You need <a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">Azure CLI</a> 2.0 to run scripts in this article. The version should be &gt;= 2.0.13.</p>
</blockquote>

<blockquote>
  <p>I used <a href="https://docs.microsoft.com/en-us/azure/container-instances/container-instances-tutorial-prepare-app">this tutorial</a> to experiment with ACR and ACI.</p>
</blockquote>

<h2 id="create-azure-container-registry">Create Azure Container Registry</h2>
<p>First, create ACR in your Azure subscription to hold your container images.</p>

<pre><code class="language-azure-cli">az acr create -n myregistry -g mygroup --location westcentralus --sku Managed_Basic --admin-enabled true
</code></pre>
<blockquote>
  <p>Complete PowerShell script <a href="https://gist.github.com/ivansharamok/15692dcfb9ed03552d9e0ebb30d089ca">create-acr.ps1</a></p>
</blockquote>

<blockquote>
  <p>At the time I used Azure containers not all regions supported Managed sku options. Most regions have <code class="highlighter-rouge">Basic</code> (a.k.a. Classic) storage for ACR which is tied to a storage account. If you want to use Managed storage, then explore which regions support it. I found a few: <code class="highlighter-rouge">eastus</code>, <code class="highlighter-rouge">westcentralus</code>.<br />
<code class="highlighter-rouge">Basic</code> (Classic) storage option for ACR does not allow to delete uploaded images. <code class="highlighter-rouge">Managed</code> options didn’t seem to have this limitation.</p>
</blockquote>

<p>Once the registry is created its full name should be <code class="highlighter-rouge">myregistry.azurecr.io</code>.</p>

<h2 id="tag-image-to-be-pushed-into-acr">Tag image to be pushed into ACR</h2>
<p>To upload a container image into your ACR, you have to tag it with full ACR name first. I used <a href="/2017-09-24/flexible-solr-container-image-for-sitecore/">flexible Solr+SSL</a> image for this.</p>
<div class="language-docker highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker tag solrssl-flex:6.6.0 myregistry.azurecr.io/solrssl-flex:6.6.0
</code></pre></div></div>
<p>Run <code class="highlighter-rouge">docker images</code> to make sure your new tagged image is listed.</p>

<h2 id="push-image-into-acr">Push image into ACR</h2>
<p>This is done by means of <code class="highlighter-rouge">docker push</code> command.</p>
<div class="language-docker highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker push myregistry.azurecr.io/solrssl-flex:6.6.0
</code></pre></div></div>
<blockquote>
  <p>Complete PowerShell script example <a href="https://gist.github.com/ivansharamok/acc36673c1be6d73c32fb87472674001">push-image2acr.ps1</a>.</p>
</blockquote>

<h2 id="create-azure-container-instance-from-acr-image">Create Azure Container Instance from ACR image</h2>
<p>To create container instance in Azure from ACR image run this command:</p>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$acrPwd</span><span class="o">=</span><span class="k">$(</span>az acr credential show -n myregistry --query <span class="s2">"passwords[0].value"</span><span class="k">)</span>
az container create -g mygroup -n mysolr --image myregistry.azurecr.io/solrssl-flex:6.6.0 --cpu 1 --memory 1.5 --registry-password <span class="nv">$acrPwd</span> --ip-address public --port 8983
</code></pre></div></div>
<blockquote>
  <p>If you want to pass a command line to be executed at the time container instance is created you can that via ` –command-line ‘my-script.sh’` parameter.</p>
</blockquote>

<blockquote>
  <p>Complete PowerShell script <a href="https://gist.github.com/ivansharamok/7bd14e3c9b733f3c1a607a725d42c433">deploy-aci-from-acr.ps1</a>.</p>
</blockquote>


          </article>
          <hr class="boundary">
          <div id="post-share">
              <!-- Go to www.addthis.com/dashboard to customize your tools -->
              <div class="addthis_inline_share_toolbox"></div>
          </div>
        </div>
        <div class="pad-min"></div>
        <div id="post-comment" class="sheet post">
            <div id="disqus_thread"></div>
        </div>
    </div>
    <div class="content-navigation col-lg-3">
      <div class="shadow-bottom-center" >
        <div class="content-navigation-toc">
            <div class="content-navigation-header">
                <span class="octicon octicon-list-unordered"></span>&nbsp;Toc
            </div>
            <div class="content-navigation-list toc"></div>
        </div>
        <div class="content-navigation-tag">
            <div class="content-navigation-header">
                <span class="octicon octicon-list-unordered"></span>&nbsp;Tags
            </div>
            <div class="content-navigation-list">
                <ul>
                    
                    <li>
                        <a href="http://localhost:4000/tags#indexing"><span class="octicon octicon-tag"></span>&nbsp;indexing</a>
                    </li>
                    
                    <li>
                        <a href="http://localhost:4000/tags#docker"><span class="octicon octicon-tag"></span>&nbsp;docker</a>
                    </li>
                    
                </ul>
            </div>
        </div>
        <div class="content-navigation-related">
            <div class="content-navigation-header">
                <span class="octicon octicon-list-unordered"></span>&nbsp;Related
            </div>
            <div class="content-navigation-list">
                <ul>
                    

                    

                    
                        
                            <li>
                                <a href="http://localhost:4000/2017-11-24/publishing-service-in-docker-container/">Sitecore Publishing Service in Docker Windows Container</a>
                            </li>
                        
                            <li>
                                <a href="http://localhost:4000/2017-11-07/run-solr-container-in-azure-kubernetes-cluster/">Run Solr container in Azure Kubernetes cluster (AKS)</a>
                            </li>
                        
                            <li>
                                <a href="http://localhost:4000/2017-09-24/flexible-solr-container-image-for-sitecore/">Flexible Solr container image for Sitecore</a>
                            </li>
                        
                            <li>
                                <a href="http://localhost:4000/2017-09-20/run-solr+ssl-in-docker-container-with-sitecore-indexes/">Run Solr + SSL in Docker container with Sitecore indexes</a>
                            </li>
                        
                            <li>
                                <a href="http://localhost:4000/2017-01-05/configure-sitecore-indexes-for-centralized-indexing-solution/">Configure Sitecore indexes for centralized indexing solution</a>
                            </li>
                        
                            <li>
                                <a href="http://localhost:4000/2017-01-04/configure-basicauth-for-solr-provider/">Configure BasicAuthentication for Solr provider with Sitecore</a>
                            </li>
                        
                            <li>
                                <a href="http://localhost:4000/2016-12-30/script-sitecore-installation-using-solrcloud-with-switchonrebuild-index/">MSDeploy Sitecore installation using SolrCloud with SwitchOnRebuild index</a>
                            </li>
                        
                            <li>
                                <a href="http://localhost:4000/2016-12-10/customize-sitecore-azuretoolkit-deployment/">Customize Sitecore Azure toolkit deployment</a>
                            </li>
                        
                    
                </ul>
            </div>
        </div>
      </div>
    </div>
</div>
<!-- Go to www.addthis.com/dashboard to customize your tools -->
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5a24c44d9a3c0d22"></script>
    </div>
    <div class="page-scrollTop" data-toggle="tooltip" data-placement="top" title="Top">
        <a href="javascript:void(0);">
            <div class="arrow"></div>
            <div class="stick"></div>
        </a>
    </div>
</div>

    <footer  class="footnote footnote-tiffany">
        <div class="container">
                <a class="foot-item" href="mailto:" target="_blank"><span class="octicon octicon-mail"></span></a>
                <a class="foot-item" href="https://github.com/ivansharamok" target="_blank"><span class="octicon octicon-mark-github"></span></a>
                <a class="foot-item" href="http://localhost:4000/feed.xml" target="_blank"><span class="octicon octicon-rss"></span></a>
                <!-- <a class="foot-item" href="http://localhost:4000/link/"><span class="octicon octicon-link-external"></span></a> -->
                &nbsp;
                <a href="http://blog.sharamok.com/"><span class="word-keep">&copy; Ivan Sharamok</span></a>
        </div>
        <div class="credit">
            Credit to WakelessDragon for <a href="https://github.com/WakelessDragon/blog">Jekyll site theme</a>.
        </div>
    </footer>
    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/1.11.3/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.bootcss.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="http://localhost:4000/static/js/script.js"></script>
    <script type="text/javascript" src="http://localhost:4000/static/js/post.js"></script>
    


</body>
</html>
